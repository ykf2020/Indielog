{"ast":null,"code":"import _slicedToArray from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{faPen}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{useSelector}from'react-redux';import firebase from'../../utils/firebase.js';import'firebase/compat/auth';import\"firebase/compat/firestore\";import\"firebase/compat/storage\";import{MemberPageContainer,TitleButtonsGroup,TitleNormalButton,TitleActiveButton,TitleDiv,PersonalInfoContainer,InfoSection,InfoTitle,InfoElementTitle,InfoElementMainDiv,ImgDiv,EditButton,Input,IntroductionArea,IntroductionDiv,ModalBackground,ModalPanel,ModalInnerTop,ModalInnerDiv,ModalInnerBottom,ModalButton,ModalImgDiv,ModalUploadButton,ModalTextArea}from'./PersonalInfoElements.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PersonalInfo=function PersonalInfo(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modalIsOpen=_useState2[0],setModalIsOpen=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),mode=_useState4[0],setMode=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),introduction=_useState6[0],setIntroduction=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),displayName=_useState8[0],setDisplayName=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),file=_useState10[0],setFile=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),shownInfo=_useState12[0],setShownInfo=_useState12[1];var previewUrl=file?URL.createObjectURL(file):'/image.png';var user=useSelector(function(store){return store.user.currentUser;});function handleUpdateAvatar(e){var userRef=firebase.firestore().collection('users').doc(user.uid);var fileRef=firebase.storage().ref('user-avatars/'+user.uid);var metadata={contentType:file.type};fileRef.put(file,metadata).then(function(){fileRef.getDownloadURL().then(function(imageUrl){user.updateProfile({photoURL:imageUrl}).then(function(){userRef.update({photoURL:imageUrl}).then(function(){setModalIsOpen(false);setFile(null);});});});});}function handleEditIntroduction(){if(introduction==='')return;firebase.firestore().collection('users').doc(user.uid).update({introduction:introduction}).then(function(){setModalIsOpen(false);setIntroduction(null);});}function handleEditDisplayName(){if(displayName==='')return;user.updateProfile({displayName:displayName}).then(function(){firebase.firestore().collection('users').doc(user.uid).update({displayName:displayName}).then(function(){setModalIsOpen(false);setDisplayName(null);});});}useEffect(function(){firebase.firestore().collection('users').doc(user.uid).onSnapshot(function(userSnapshot){setShownInfo(userSnapshot.data());});},[]);return/*#__PURE__*/_jsxs(MemberPageContainer,{children:[/*#__PURE__*/_jsxs(TitleButtonsGroup,{children:[/*#__PURE__*/_jsx(TitleActiveButton,{children:\"\\u6703\\u54E1\\u8CC7\\u6599\"}),/*#__PURE__*/_jsx(TitleNormalButton,{to:\"/member/myposts\",children:\"\\u6211\\u7684\\u6587\\u7AE0\"})]}),/*#__PURE__*/_jsxs(PersonalInfoContainer,{children:[/*#__PURE__*/_jsx(TitleDiv,{children:/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u57FA\\u672C\\u8CC7\\u6599\"})}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u982D\\u50CF\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(ImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{src:shownInfo.photoURL?shownInfo.photoURL:'/default-user-image.png'})}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(1);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u5E33\\u865F\"}),/*#__PURE__*/_jsx(InfoElementMainDiv,{children:/*#__PURE__*/_jsx(Input,{disabled:true,value:shownInfo.email})})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(Input,{disabled:true,value:'******'}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(2);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u66B1\\u7A31\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(Input,{disabled:true,value:shownInfo.displayName}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(3);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u81EA\\u6211\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsxs(IntroductionDiv,{children:[/*#__PURE__*/_jsx(IntroductionArea,{children:shownInfo.introduction?shownInfo.introduction:'尚未新增自我介紹'}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(4);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),modalIsOpen&&/*#__PURE__*/_jsxs(ModalBackground,{children:[mode===1&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u982D\\u50CF\"}),/*#__PURE__*/_jsxs(ModalInnerTop,{children:[/*#__PURE__*/_jsx(ModalImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{src:previewUrl})}),/*#__PURE__*/_jsx(ModalUploadButton,{htmlFor:\"post-image\",children:\"\\u4E0A\\u50B3\\u5716\\u7247\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"post-image\",style:{display:'none'},onChange:function onChange(e){return setFile(e.target.files[0]);}})]}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){handleUpdateAvatar();},children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===2&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsxs(ModalInnerTop,{children:[/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u76EE\\u524D\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{})]}),/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{})]}),/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u518D\\u6B21\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{})]})]}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===3&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u66B1\\u7A31\"}),/*#__PURE__*/_jsx(ModalInnerTop,{children:/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u65B0\\u66B1\\u7A31\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"\\u9650\\u516B\\u500B\\u5B57\\u5143\\u4EE5\\u5167\",value:displayName,onChange:function onChange(e){return setDisplayName(e.target.value);}})]})}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:handleEditDisplayName,children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===4&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u81EA\\u6211\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsx(ModalInnerTop,{children:/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u81EA\\u6211\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsx(ModalTextArea,{value:introduction,onChange:function onChange(e){setIntroduction(e.target.value);}})]})}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:handleEditIntroduction,children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]})]})]})]});};export default PersonalInfo;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/indielog/src/pages/PersonalInfo/index.js"],"names":["useState","useEffect","faPen","FontAwesomeIcon","useSelector","firebase","MemberPageContainer","TitleButtonsGroup","TitleNormalButton","TitleActiveButton","TitleDiv","PersonalInfoContainer","InfoSection","InfoTitle","InfoElementTitle","InfoElementMainDiv","ImgDiv","EditButton","Input","IntroductionArea","IntroductionDiv","ModalBackground","ModalPanel","ModalInnerTop","ModalInnerDiv","ModalInnerBottom","ModalButton","ModalImgDiv","ModalUploadButton","ModalTextArea","PersonalInfo","modalIsOpen","setModalIsOpen","mode","setMode","introduction","setIntroduction","displayName","setDisplayName","file","setFile","shownInfo","setShownInfo","previewUrl","URL","createObjectURL","user","store","currentUser","handleUpdateAvatar","e","userRef","firestore","collection","doc","uid","fileRef","storage","ref","metadata","contentType","type","put","then","getDownloadURL","imageUrl","updateProfile","photoURL","update","handleEditIntroduction","handleEditDisplayName","onSnapshot","userSnapshot","data","email","display","target","files","value"],"mappings":"2HAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,KAAT,KAAsB,mCAAtB,CACA,OAASC,eAAT,KAAgC,gCAAhC,CACA,OAASC,WAAT,KAA4B,aAA5B,CACA,MAAOC,CAAAA,QAAP,KAAqB,yBAArB,CACA,MAAO,sBAAP,CACA,MAAO,2BAAP,CACA,MAAO,yBAAP,CACA,OACEC,mBADF,CAEEC,iBAFF,CAGEC,iBAHF,CAIEC,iBAJF,CAKEC,QALF,CAMEC,qBANF,CAOEC,WAPF,CAQEC,SARF,CASEC,gBATF,CAUEC,kBAVF,CAWEC,MAXF,CAYEC,UAZF,CAaEC,KAbF,CAcEC,gBAdF,CAeEC,eAfF,CAgBEC,eAhBF,CAiBEC,UAjBF,CAkBEC,aAlBF,CAmBEC,aAnBF,CAoBEC,gBApBF,CAqBEC,WArBF,CAsBEC,WAtBF,CAuBEC,iBAvBF,CAwBEC,aAxBF,KAyBO,2BAzBP,C,wFA4BA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CACzB,cAAsC9B,QAAQ,CAAC,KAAD,CAA9C,wCAAO+B,WAAP,eAAoBC,cAApB,eACA,eAAwBhC,QAAQ,CAAC,CAAD,CAAhC,yCAAOiC,IAAP,eAAaC,OAAb,eACA,eAAwClC,QAAQ,CAAC,EAAD,CAAhD,yCAAOmC,YAAP,eAAqBC,eAArB,eACA,eAAsCpC,QAAQ,CAAC,EAAD,CAA9C,yCAAOqC,WAAP,eAAoBC,cAApB,eACA,eAAwBtC,QAAQ,CAAC,IAAD,CAAhC,0CAAOuC,IAAP,gBAAaC,OAAb,gBACA,gBAAkCxC,QAAQ,CAAC,EAAD,CAA1C,2CAAOyC,SAAP,gBAAkBC,YAAlB,gBACA,GAAMC,CAAAA,UAAU,CAAGJ,IAAI,CAAGK,GAAG,CAACC,eAAJ,CAAoBN,IAApB,CAAH,CAA+B,YAAtD,CACA,GAAMO,CAAAA,IAAI,CAAG1C,WAAW,CAAC,SAAC2C,KAAD,QAAWA,CAAAA,KAAK,CAACD,IAAN,CAAWE,WAAtB,EAAD,CAAxB,CAEA,QAASC,CAAAA,kBAAT,CAA4BC,CAA5B,CAA+B,CAC7B,GAAMC,CAAAA,OAAO,CAAG9C,QAAQ,CAAC+C,SAAT,GAAqBC,UAArB,CAAgC,OAAhC,EAAyCC,GAAzC,CAA6CR,IAAI,CAACS,GAAlD,CAAhB,CACA,GAAMC,CAAAA,OAAO,CAAGnD,QAAQ,CAACoD,OAAT,GAAmBC,GAAnB,CAAuB,gBAAkBZ,IAAI,CAACS,GAA9C,CAAhB,CACA,GAAMI,CAAAA,QAAQ,CAAG,CACfC,WAAW,CAAErB,IAAI,CAACsB,IADH,CAAjB,CAIAL,OAAO,CAACM,GAAR,CAAYvB,IAAZ,CAAkBoB,QAAlB,EAA4BI,IAA5B,CAAiC,UAAM,CACrCP,OAAO,CAACQ,cAAR,GAAyBD,IAAzB,CAA8B,SAACE,QAAD,CAAc,CAC1CnB,IAAI,CAACoB,aAAL,CAAmB,CACjBC,QAAQ,CAACF,QADQ,CAAnB,EAEGF,IAFH,CAEQ,UAAM,CACZZ,OAAO,CAACiB,MAAR,CAAe,CACbD,QAAQ,CAACF,QADI,CAAf,EAGCF,IAHD,CAGM,UAAM,CACV/B,cAAc,CAAC,KAAD,CAAd,CACAQ,OAAO,CAAC,IAAD,CAAP,CACD,CAND,EAOD,CAVD,EAWD,CAZD,EAaD,CAdD,EAeD,CAED,QAAS6B,CAAAA,sBAAT,EAAkC,CAChC,GAAGlC,YAAY,GAAK,EAApB,CAAwB,OACxB9B,QAAQ,CACL+C,SADH,GAEGC,UAFH,CAEc,OAFd,EAGGC,GAHH,CAGOR,IAAI,CAACS,GAHZ,EAIGa,MAJH,CAIU,CACNjC,YAAY,CAAZA,YADM,CAJV,EAMK4B,IANL,CAMU,UAAM,CACZ/B,cAAc,CAAC,KAAD,CAAd,CACAI,eAAe,CAAC,IAAD,CAAf,CACD,CATH,EAUD,CAED,QAASkC,CAAAA,qBAAT,EAAiC,CAC/B,GAAGjC,WAAW,GAAK,EAAnB,CAAuB,OACvBS,IAAI,CAACoB,aAAL,CAAmB,CACjB7B,WAAW,CAAXA,WADiB,CAAnB,EAEG0B,IAFH,CAEQ,UAAM,CACZ1D,QAAQ,CACL+C,SADH,GAEGC,UAFH,CAEc,OAFd,EAGGC,GAHH,CAGOR,IAAI,CAACS,GAHZ,EAIGa,MAJH,CAIU,CACN/B,WAAW,CAAXA,WADM,CAJV,EAMK0B,IANL,CAMU,UAAM,CACZ/B,cAAc,CAAC,KAAD,CAAd,CACAM,cAAc,CAAC,IAAD,CAAd,CACD,CATH,EAUD,CAbD,EAcD,CAEDrC,SAAS,CAAC,UAAM,CACdI,QAAQ,CACL+C,SADH,GAEGC,UAFH,CAEc,OAFd,EAGGC,GAHH,CAGOR,IAAI,CAACS,GAHZ,EAIGgB,UAJH,CAIc,SAACC,YAAD,CAAkB,CAC5B9B,YAAY,CAAC8B,YAAY,CAACC,IAAb,EAAD,CAAZ,CACD,CANH,EAOD,CARQ,CAQP,EARO,CAAT,CAUA,mBACI,MAAC,mBAAD,yBACE,MAAC,iBAAD,yBACE,KAAC,iBAAD,uCADF,cAEE,KAAC,iBAAD,EAAmB,EAAE,CAAC,iBAAtB,sCAFF,GADF,cAKE,MAAC,qBAAD,yBACE,KAAC,QAAD,wBAAU,KAAC,SAAD,uCAAV,EADF,cAEE,MAAC,WAAD,yBACE,KAAC,gBAAD,2BADF,cAEE,MAAC,kBAAD,yBACE,KAAC,MAAD,wBAAQ,YAAK,GAAG,CAAEhC,SAAS,CAAC0B,QAAV,CAAqB1B,SAAS,CAAC0B,QAA/B,CAA0C,yBAApD,EAAR,EADF,cAEE,KAAC,UAAD,EACE,OAAO,CAAE,kBAAM,CAACnC,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAD1D,uBAEE,KAAC,eAAD,EAAiB,IAAI,CAAC,IAAtB,CAA2B,IAAI,CAAEhC,KAAjC,EAFF,EAFF,GAFF,GAFF,cAYE,MAAC,WAAD,yBACE,KAAC,gBAAD,2BADF,cAEE,KAAC,kBAAD,wBACE,KAAC,KAAD,EAAO,QAAQ,KAAf,CAAgB,KAAK,CAAEuC,SAAS,CAACiC,KAAjC,EADF,EAFF,GAZF,cAkBE,MAAC,WAAD,yBACE,KAAC,gBAAD,2BADF,cAEE,MAAC,kBAAD,yBACE,KAAC,KAAD,EAAO,QAAQ,KAAf,CAAgB,KAAK,CAAE,QAAvB,EADF,cAEE,KAAC,UAAD,EAAY,OAAO,CAAE,kBAAM,CAAC1C,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAApE,uBAAsE,KAAC,eAAD,EAAiB,IAAI,CAAC,IAAtB,CAA2B,IAAI,CAAEhC,KAAjC,EAAtE,EAFF,GAFF,GAlBF,cAyBE,MAAC,WAAD,yBACE,KAAC,gBAAD,2BADF,cAEE,MAAC,kBAAD,yBACE,KAAC,KAAD,EAAO,QAAQ,KAAf,CAAgB,KAAK,CAAEuC,SAAS,CAACJ,WAAjC,EADF,cAEE,KAAC,UAAD,EAAY,OAAO,CAAE,kBAAM,CAACL,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAApE,uBAAsE,KAAC,eAAD,EAAiB,IAAI,CAAC,IAAtB,CAA2B,IAAI,CAAEhC,KAAjC,EAAtE,EAFF,GAFF,GAzBF,cAgCE,MAAC,WAAD,yBACE,KAAC,gBAAD,uCADF,cAEE,MAAC,eAAD,yBACE,KAAC,gBAAD,WAAmBuC,SAAS,CAACN,YAAV,CAAyBM,SAAS,CAACN,YAAnC,CAAkD,UAArE,EADF,cAEE,KAAC,UAAD,EAAY,OAAO,CAAE,kBAAM,CAACH,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAApE,uBAAsE,KAAC,eAAD,EAAiB,IAAI,CAAC,IAAtB,CAA2B,IAAI,CAAEhC,KAAjC,EAAtE,EAFF,GAFF,GAhCF,CAuCG6B,WAAW,eACV,MAAC,eAAD,YACGE,IAAI,GAAK,CAAT,eACC,MAAC,UAAD,yBACE,KAAC,SAAD,uCADF,cAEE,MAAC,aAAD,yBACE,KAAC,WAAD,wBAAa,YAAK,GAAG,CAAEU,UAAV,EAAb,EADF,cAEE,KAAC,iBAAD,EAAmB,OAAO,CAAC,YAA3B,sCAFF,cAGE,cACA,IAAI,CAAC,MADL,CAEA,EAAE,CAAC,YAFH,CAGA,KAAK,CAAE,CAACgC,OAAO,CAAE,MAAV,CAHP,CAIA,QAAQ,CAAE,kBAACzB,CAAD,QAAOV,CAAAA,OAAO,CAACU,CAAC,CAAC0B,MAAF,CAASC,KAAT,CAAe,CAAf,CAAD,CAAd,EAJV,EAHF,GAFF,cAWE,MAAC,gBAAD,yBACE,KAAC,WAAD,EAAa,OAAO,CAAE,kBAAM,CAAC5B,kBAAkB,GAAG,CAAlD,0BADF,cAEE,KAAC,WAAD,EAAa,OAAO,CAAE,kBAAM,CAACjB,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAArE,0BAFF,GAXF,GAFJ,CAmBGD,IAAI,GAAK,CAAT,eACC,MAAC,UAAD,yBACE,KAAC,SAAD,uCADF,cAEE,MAAC,aAAD,yBACA,MAAC,aAAD,yBACE,KAAC,gBAAD,mDADF,cAEE,KAAC,KAAD,IAFF,GADA,cAKE,MAAC,aAAD,yBACE,KAAC,gBAAD,6CADF,cAEE,KAAC,KAAD,IAFF,GALF,cASE,MAAC,aAAD,yBACE,KAAC,gBAAD,yDADF,cAEE,KAAC,KAAD,IAFF,GATF,GAFF,cAgBE,MAAC,gBAAD,yBACE,KAAC,WAAD,2BADF,cAEE,KAAC,WAAD,EAAa,OAAO,CAAE,kBAAM,CAACD,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAArE,0BAFF,GAhBF,GApBJ,CA0CGD,IAAI,GAAK,CAAT,eACC,MAAC,UAAD,yBACE,KAAC,SAAD,uCADF,cAEE,KAAC,aAAD,wBACE,MAAC,aAAD,yBACE,KAAC,gBAAD,6CADF,cAEE,KAAC,KAAD,EAAO,WAAW,CAAC,4CAAnB,CAA6B,KAAK,CAAEI,WAApC,CAAiD,QAAQ,CAAE,kBAACa,CAAD,QAAOZ,CAAAA,cAAc,CAACY,CAAC,CAAC0B,MAAF,CAASE,KAAV,CAArB,EAA3D,EAFF,GADF,EAFF,cAQE,MAAC,gBAAD,yBACE,KAAC,WAAD,EAAa,OAAO,CAAER,qBAAtB,0BADF,cAEE,KAAC,WAAD,EAAa,OAAO,CAAE,kBAAM,CAACtC,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAArE,0BAFF,GARF,GA3CJ,CAyDGD,IAAI,GAAK,CAAT,eACC,MAAC,UAAD,yBACE,KAAC,SAAD,mDADF,cAEE,KAAC,aAAD,wBACE,MAAC,aAAD,yBACE,KAAC,gBAAD,mDADF,cAEE,KAAC,aAAD,EAAe,KAAK,CAAEE,YAAtB,CAAoC,QAAQ,CAAE,kBAACe,CAAD,CAAO,CAACd,eAAe,CAACc,CAAC,CAAC0B,MAAF,CAASE,KAAV,CAAf,CAAgC,CAAtF,EAFF,GADF,EAFF,cAQE,MAAC,gBAAD,yBACE,KAAC,WAAD,EAAa,OAAO,CAAET,sBAAtB,0BADF,cAEE,KAAC,WAAD,EAAa,OAAO,CAAE,kBAAM,CAACrC,cAAc,CAAC,CAACD,WAAF,CAAd,CAA6BG,OAAO,CAAC,CAAD,CAAP,CAAW,CAArE,0BAFF,GARF,GA1DJ,GAxCJ,GALF,GADJ,CA2HD,CAvMD,CAyMA,cAAeJ,CAAAA,YAAf","sourcesContent":["import { useState, useEffect } from 'react'\nimport { faPen } from '@fortawesome/free-solid-svg-icons'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useSelector } from 'react-redux'\nimport firebase from '../../utils/firebase.js'\nimport 'firebase/compat/auth'\nimport \"firebase/compat/firestore\"\nimport \"firebase/compat/storage\"\nimport {\n  MemberPageContainer,\n  TitleButtonsGroup,\n  TitleNormalButton,\n  TitleActiveButton,\n  TitleDiv,\n  PersonalInfoContainer,\n  InfoSection,\n  InfoTitle,\n  InfoElementTitle,\n  InfoElementMainDiv,\n  ImgDiv,\n  EditButton,\n  Input,\n  IntroductionArea,\n  IntroductionDiv,\n  ModalBackground,\n  ModalPanel,\n  ModalInnerTop,\n  ModalInnerDiv,\n  ModalInnerBottom,\n  ModalButton,\n  ModalImgDiv,\n  ModalUploadButton,\n  ModalTextArea,\n} from './PersonalInfoElements.js'\n\n\nconst PersonalInfo = () => {\n  const [modalIsOpen, setModalIsOpen] = useState(false)\n  const [mode, setMode] = useState(0)\n  const [introduction, setIntroduction] = useState('')\n  const [displayName, setDisplayName] = useState('')\n  const [file, setFile] = useState(null)\n  const [shownInfo, setShownInfo] = useState({})\n  const previewUrl = file ? URL.createObjectURL(file) : '/image.png'\n  const user = useSelector((store) => store.user.currentUser)\n\n  function handleUpdateAvatar(e) {\n    const userRef = firebase.firestore().collection('users').doc(user.uid)\n    const fileRef = firebase.storage().ref('user-avatars/' + user.uid)\n    const metadata = {\n      contentType: file.type\n    }\n\n    fileRef.put(file, metadata).then(() => {\n      fileRef.getDownloadURL().then((imageUrl) => {\n        user.updateProfile({\n          photoURL:imageUrl\n        }).then(() => {\n          userRef.update({\n            photoURL:imageUrl,\n          })\n          .then(() => {\n            setModalIsOpen(false)\n            setFile(null)\n          })\n        })\n      })\n    })\n  }\n\n  function handleEditIntroduction() {\n    if(introduction === '') return\n    firebase\n      .firestore()\n      .collection('users')\n      .doc(user.uid)\n      .update({\n        introduction,\n      }).then(() => {\n        setModalIsOpen(false)\n        setIntroduction(null)\n      })\n  }\n\n  function handleEditDisplayName() {\n    if(displayName === '') return\n    user.updateProfile({\n      displayName,\n    }).then(() => {\n      firebase\n        .firestore()\n        .collection('users')\n        .doc(user.uid)\n        .update({\n          displayName,\n        }).then(() => {\n          setModalIsOpen(false)\n          setDisplayName(null)\n        })\n    })\n  }\n\n  useEffect(() => {\n    firebase\n      .firestore()\n      .collection('users')\n      .doc(user.uid)\n      .onSnapshot((userSnapshot) => {\n        setShownInfo(userSnapshot.data())\n      })\n  },[])\n\n  return (\n      <MemberPageContainer>\n        <TitleButtonsGroup>\n          <TitleActiveButton>會員資料</TitleActiveButton>\n          <TitleNormalButton to='/member/myposts'>我的文章</TitleNormalButton>\n        </TitleButtonsGroup>\n        <PersonalInfoContainer>\n          <TitleDiv><InfoTitle>基本資料</InfoTitle></TitleDiv>\n          <InfoSection>\n            <InfoElementTitle>頭像</InfoElementTitle>\n            <InfoElementMainDiv>\n              <ImgDiv><img src={shownInfo.photoURL ? shownInfo.photoURL : '/default-user-image.png'}/></ImgDiv>\n              <EditButton\n                onClick={() => {setModalIsOpen(!modalIsOpen);setMode(1)}}>\n                <FontAwesomeIcon size='1x' icon={faPen}/>\n              </EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>帳號</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={shownInfo.email}/>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>密碼</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={'******'}/>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(2)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>暱稱</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={shownInfo.displayName}/>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(3)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>自我介紹</InfoElementTitle>\n            <IntroductionDiv>\n              <IntroductionArea>{shownInfo.introduction ? shownInfo.introduction : '尚未新增自我介紹'}</IntroductionArea>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(4)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </IntroductionDiv>\n          </InfoSection>\n          {modalIsOpen &&\n            <ModalBackground>\n              {mode === 1 &&\n                <ModalPanel>\n                  <InfoTitle>修改頭像</InfoTitle>\n                  <ModalInnerTop>\n                    <ModalImgDiv><img src={previewUrl}/></ModalImgDiv>\n                    <ModalUploadButton htmlFor='post-image'>上傳圖片</ModalUploadButton>\n                    <input\n                    type=\"file\"\n                    id='post-image'\n                    style={{display: 'none'}}\n                    onChange={(e) => setFile(e.target.files[0])}/>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={() => {handleUpdateAvatar()}}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 2 &&\n                <ModalPanel>\n                  <InfoTitle>修改密碼</InfoTitle>\n                  <ModalInnerTop>\n                  <ModalInnerDiv>\n                    <InfoElementTitle>輸入目前密碼</InfoElementTitle>\n                    <Input />\n                  </ModalInnerDiv>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入新密碼</InfoElementTitle>\n                      <Input />\n                    </ModalInnerDiv>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>再次輸入新密碼</InfoElementTitle>\n                      <Input />\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 3 &&\n                <ModalPanel>\n                  <InfoTitle>修改暱稱</InfoTitle>\n                  <ModalInnerTop>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入新暱稱</InfoElementTitle>\n                      <Input placeholder='限八個字元以內' value={displayName} onChange={(e) => setDisplayName(e.target.value)}/>\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={handleEditDisplayName}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 4 &&\n                <ModalPanel>\n                  <InfoTitle>修改自我介紹</InfoTitle>\n                  <ModalInnerTop>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入自我介紹</InfoElementTitle>\n                      <ModalTextArea value={introduction} onChange={(e) => {setIntroduction(e.target.value)}}/>\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={handleEditIntroduction}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n            </ModalBackground>\n          }\n        </PersonalInfoContainer>\n      </MemberPageContainer>\n  )\n}\n\nexport default PersonalInfo\n"]},"metadata":{},"sourceType":"module"}
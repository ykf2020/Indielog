{"ast":null,"code":"import _regeneratorRuntime from\"/Users/fanyukun/Documents/react/Indielog/Indielog/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/fanyukun/Documents/react/Indielog/Indielog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/fanyukun/Documents/react/Indielog/Indielog/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{useParams}from'react-router-dom';import{useDispatch,useSelector}from\"react-redux\";import{getSongOnSnapShot,toggleSongLiked}from'../../utils/firebase';import CommentArea from'../../components/CommentArea';import{faHeart,faPlay}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{setCurrentSong}from\"../../redux/reducers/songReducer\";import{setMode,setIsPlaying}from\"../../redux/reducers/playerControlReducer\";import{setCurrentTitle}from\"../../redux/reducers/pageTitleReducer\";import{SongPageConatainer,SongInfoCategory,MainInfoBackground,MainInfoContainer,MainImgDiv,MainInfoDiv,MainInfoSongName,MainInfoSongInfoDiv,NumInfo,InfoDesc,InfoDescNum,BodyContainer,MainBodyContainer,FoldSection,FoldInfo,FoldingCover,CoverDesc,Content,ArtistContainer,ArtistInfo,ArtistInfoLeftDiv,ArtistInfoNames,ArtistName,AuthorizedDesc,ArtistImgDiv,ArtistButton,SongUpdate,ButtonsGroup,LikedButtonDiv}from'./SongElements.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Song=function Song(){var _pageData$likedBy,_pageData$likedBy2;var dispatch=useDispatch();var _useParams=useParams(),songId=_useParams.songId;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),foldSection1=_useState2[0],setFoldSection1=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),foldSection2=_useState4[0],setFoldSection2=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),pageData=_useState6[0],setPageData=_useState6[1];var user=useSelector(function(store){return store.user.currentUser;});var isLiked=(_pageData$likedBy=pageData.likedBy)===null||_pageData$likedBy===void 0?void 0:_pageData$likedBy.includes(user===null||user===void 0?void 0:user.uid);function playSong(_x){return _playSong.apply(this,arguments);}function _playSong(){_playSong=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(song){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dispatch(setIsPlaying(true));case 2:_context.next=4;return dispatch(setCurrentSong(song));case 4:_context.next=6;return dispatch(setMode(2));case 6:case\"end\":return _context.stop();}}},_callee);}));return _playSong.apply(this,arguments);}function toggleLiked(){if(!user){alert('請先登入會員才能按讚～');return;}toggleSongLiked(isLiked,songId,user.uid);}useEffect(function(){getSongOnSnapShot(songId,setPageData);},[songId]);useEffect(function(){if(!pageData)return;dispatch(setCurrentTitle(pageData.name));return function(){dispatch(setCurrentTitle('Indielog'));};},[pageData]);return/*#__PURE__*/_jsxs(SongPageConatainer,{children:[/*#__PURE__*/_jsx(MainInfoBackground,{bgImg:pageData.cover,children:/*#__PURE__*/_jsxs(MainInfoContainer,{children:[/*#__PURE__*/_jsx(MainImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:pageData.cover})}),/*#__PURE__*/_jsxs(MainInfoDiv,{children:[/*#__PURE__*/_jsx(MainInfoSongName,{children:pageData.name}),/*#__PURE__*/_jsx(SongInfoCategory,{children:\"Experimental\"}),/*#__PURE__*/_jsxs(MainInfoSongInfoDiv,{children:[/*#__PURE__*/_jsxs(NumInfo,{children:[/*#__PURE__*/_jsx(InfoDesc,{children:\"\\u64AD\\u653E\\u6B21\\u6578\"}),/*#__PURE__*/_jsx(InfoDescNum,{children:\"10,000\"})]}),/*#__PURE__*/_jsxs(NumInfo,{children:[/*#__PURE__*/_jsx(InfoDesc,{children:\"\\u559C\\u6B61\"}),/*#__PURE__*/_jsx(InfoDescNum,{children:(_pageData$likedBy2=pageData.likedBy)===null||_pageData$likedBy2===void 0?void 0:_pageData$likedBy2.length})]}),/*#__PURE__*/_jsxs(ButtonsGroup,{children:[/*#__PURE__*/_jsx(LikedButtonDiv,{onClick:function onClick(){return playSong(pageData);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faPlay})}),/*#__PURE__*/_jsx(LikedButtonDiv,{isLiked:isLiked,onClick:toggleLiked,children:/*#__PURE__*/_jsx(FontAwesomeIcon,{icon:faHeart})})]})]})]})]})}),/*#__PURE__*/_jsxs(BodyContainer,{children:[/*#__PURE__*/_jsxs(ArtistContainer,{children:[/*#__PURE__*/_jsxs(ArtistInfo,{children:[/*#__PURE__*/_jsxs(ArtistInfoLeftDiv,{children:[/*#__PURE__*/_jsx(ArtistImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:pageData.cover})}),/*#__PURE__*/_jsxs(ArtistInfoNames,{children:[/*#__PURE__*/_jsx(ArtistName,{children:pageData.artist}),/*#__PURE__*/_jsx(AuthorizedDesc,{children:\"\\u8A8D\\u8B49\\u5275\\u4F5C\\u8005\"})]})]}),/*#__PURE__*/_jsx(ArtistButton,{children:\"\\uFF0B\\u8FFD\\u8E64\"})]}),/*#__PURE__*/_jsx(SongUpdate,{children:\"\\u767C\\u4F48\\u6642\\u9593 2021-09-15\"})]}),/*#__PURE__*/_jsxs(MainBodyContainer,{children:[/*#__PURE__*/_jsxs(FoldSection,{children:[/*#__PURE__*/_jsxs(FoldInfo,{isFold:foldSection1,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsx(Content,{dangerouslySetInnerHTML:{__html:pageData.introduction}})]}),/*#__PURE__*/_jsx(FoldingCover,{isFold:foldSection1,children:/*#__PURE__*/_jsx(CoverDesc,{onClick:function onClick(){return setFoldSection1(!foldSection1);},children:foldSection1?'收合':'...查看更多'})})]}),/*#__PURE__*/_jsxs(FoldSection,{children:[/*#__PURE__*/_jsxs(FoldInfo,{isFold:foldSection2,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u6B4C\\u8A5E\"}),/*#__PURE__*/_jsx(Content,{dangerouslySetInnerHTML:{__html:pageData.lyrics}})]}),/*#__PURE__*/_jsx(FoldingCover,{isFold:foldSection2,children:/*#__PURE__*/_jsx(CoverDesc,{onClick:function onClick(){return setFoldSection2(!foldSection2);},children:foldSection2?'收合':'...查看更多'})})]}),/*#__PURE__*/_jsx(CommentArea,{area:'songs',id:songId})]})]})]});};export default Song;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/Indielog/Indielog/src/pages/Song/index.js"],"names":["useState","useEffect","useParams","useDispatch","useSelector","getSongOnSnapShot","toggleSongLiked","CommentArea","faHeart","faPlay","FontAwesomeIcon","setCurrentSong","setMode","setIsPlaying","setCurrentTitle","SongPageConatainer","SongInfoCategory","MainInfoBackground","MainInfoContainer","MainImgDiv","MainInfoDiv","MainInfoSongName","MainInfoSongInfoDiv","NumInfo","InfoDesc","InfoDescNum","BodyContainer","MainBodyContainer","FoldSection","FoldInfo","FoldingCover","CoverDesc","Content","ArtistContainer","ArtistInfo","ArtistInfoLeftDiv","ArtistInfoNames","ArtistName","AuthorizedDesc","ArtistImgDiv","ArtistButton","SongUpdate","ButtonsGroup","LikedButtonDiv","Song","dispatch","songId","foldSection1","setFoldSection1","foldSection2","setFoldSection2","pageData","setPageData","user","store","currentUser","isLiked","likedBy","includes","uid","playSong","song","toggleLiked","alert","name","cover","length","artist","__html","introduction","lyrics"],"mappings":"yYAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,iBAAT,CAA4BC,eAA5B,KAAmD,sBAAnD,CACA,MAAOC,CAAAA,WAAP,KAAwB,8BAAxB,CACA,OAASC,OAAT,CAAkBC,MAAlB,KAAgC,mCAAhC,CACA,OAASC,eAAT,KAAgC,gCAAhC,CACA,OAASC,cAAT,KAA+B,kCAA/B,CACA,OAASC,OAAT,CAAkBC,YAAlB,KAAsC,2CAAtC,CACA,OAASC,eAAT,KAAgC,uCAAhC,CACA,OACEC,kBADF,CAEEC,gBAFF,CAGEC,kBAHF,CAIEC,iBAJF,CAKEC,UALF,CAMEC,WANF,CAOEC,gBAPF,CAQEC,mBARF,CASEC,OATF,CAUEC,QAVF,CAWEC,WAXF,CAYEC,aAZF,CAaEC,iBAbF,CAcEC,WAdF,CAeEC,QAfF,CAgBEC,YAhBF,CAiBEC,SAjBF,CAkBEC,OAlBF,CAmBEC,eAnBF,CAoBEC,UApBF,CAqBEC,iBArBF,CAsBEC,eAtBF,CAuBEC,UAvBF,CAwBEC,cAxBF,CAyBEC,YAzBF,CA0BEC,YA1BF,CA2BEC,UA3BF,CA4BEC,YA5BF,CA6BEC,cA7BF,KA8BO,mBA9BP,C,wFAiCA,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,EAAM,0CACjB,GAAMC,CAAAA,QAAQ,CAAG1C,WAAW,EAA5B,CACA,eAAmBD,SAAS,EAA5B,CAAQ4C,MAAR,YAAQA,MAAR,CACA,cAAwC9C,QAAQ,CAAC,KAAD,CAAhD,wCAAO+C,YAAP,eAAqBC,eAArB,eACA,eAAwChD,QAAQ,CAAC,KAAD,CAAhD,yCAAOiD,YAAP,eAAqBC,eAArB,eACA,eAAgClD,QAAQ,CAAC,EAAD,CAAxC,yCAAOmD,QAAP,eAAiBC,WAAjB,eACA,GAAMC,CAAAA,IAAI,CAAGjD,WAAW,CAAC,SAACkD,KAAD,QAAWA,CAAAA,KAAK,CAACD,IAAN,CAAWE,WAAtB,EAAD,CAAxB,CACA,GAAMC,CAAAA,OAAO,oBAAGL,QAAQ,CAACM,OAAZ,4CAAG,kBAAkBC,QAAlB,CAA2BL,IAA3B,SAA2BA,IAA3B,iBAA2BA,IAAI,CAAEM,GAAjC,CAAhB,CAPiB,QASFC,CAAAA,QATE,oIASjB,iBAAwBC,IAAxB,wIACQhB,CAAAA,QAAQ,CAAChC,YAAY,CAAC,IAAD,CAAb,CADhB,8BAEQgC,CAAAA,QAAQ,CAAClC,cAAc,CAACkD,IAAD,CAAf,CAFhB,8BAGQhB,CAAAA,QAAQ,CAACjC,OAAO,CAAC,CAAD,CAAR,CAHhB,uDATiB,2CAejB,QAASkD,CAAAA,WAAT,EAAuB,CACrB,GAAG,CAACT,IAAJ,CAAU,CACRU,KAAK,CAAC,aAAD,CAAL,CACA,OACD,CACDzD,eAAe,CAACkD,OAAD,CAAUV,MAAV,CAAkBO,IAAI,CAACM,GAAvB,CAAf,CACD,CAED1D,SAAS,CAAC,UAAM,CACdI,iBAAiB,CAACyC,MAAD,CAASM,WAAT,CAAjB,CACD,CAFQ,CAEP,CAACN,MAAD,CAFO,CAAT,CAIA7C,SAAS,CAAC,UAAM,CACd,GAAG,CAACkD,QAAJ,CAAc,OACdN,QAAQ,CAAC/B,eAAe,CAACqC,QAAQ,CAACa,IAAV,CAAhB,CAAR,CACA,MAAO,WAAM,CACXnB,QAAQ,CAAC/B,eAAe,CAAC,UAAD,CAAhB,CAAR,CACD,CAFD,CAGD,CANQ,CAMP,CAACqC,QAAD,CANO,CAAT,CAQA,mBACE,MAAC,kBAAD,yBACE,KAAC,kBAAD,EAAoB,KAAK,CAAEA,QAAQ,CAACc,KAApC,uBACE,MAAC,iBAAD,yBACE,KAAC,UAAD,wBAAY,YAAK,GAAG,CAAC,EAAT,CAAY,GAAG,CAAEd,QAAQ,CAACc,KAA1B,EAAZ,EADF,cAEE,MAAC,WAAD,yBACE,KAAC,gBAAD,WAAmBd,QAAQ,CAACa,IAA5B,EADF,cAEE,KAAC,gBAAD,2BAFF,cAGE,MAAC,mBAAD,yBACA,MAAC,OAAD,yBACE,KAAC,QAAD,uCADF,cAEE,KAAC,WAAD,qBAFF,GADA,cAKA,MAAC,OAAD,yBACE,KAAC,QAAD,2BADF,cAEE,KAAC,WAAD,+BAAcb,QAAQ,CAACM,OAAvB,6CAAc,mBAAkBS,MAAhC,EAFF,GALA,cASA,MAAC,YAAD,yBACE,KAAC,cAAD,EAAgB,OAAO,CAAE,yBAAMN,CAAAA,QAAQ,CAACT,QAAD,CAAd,EAAzB,uBACE,KAAC,eAAD,EAAiB,IAAI,CAAE1C,MAAvB,EADF,EADF,cAIE,KAAC,cAAD,EAAgB,OAAO,CAAE+C,OAAzB,CAAkC,OAAO,CAAEM,WAA3C,uBACE,KAAC,eAAD,EAAkB,IAAI,CAAEtD,OAAxB,EADF,EAJF,GATA,GAHF,GAFF,GADF,EADF,cA4BE,MAAC,aAAD,yBACE,MAAC,eAAD,yBACA,MAAC,UAAD,yBACE,MAAC,iBAAD,yBACE,KAAC,YAAD,wBAAc,YAAK,GAAG,CAAC,EAAT,CAAY,GAAG,CAAE2C,QAAQ,CAACc,KAA1B,EAAd,EADF,cAEE,MAAC,eAAD,yBACE,KAAC,UAAD,WAAad,QAAQ,CAACgB,MAAtB,EADF,cAEE,KAAC,cAAD,6CAFF,GAFF,GADF,cAQE,KAAC,YAAD,iCARF,GADA,cAWA,KAAC,UAAD,kDAXA,GADF,cAcE,MAAC,iBAAD,yBACE,MAAC,WAAD,yBACE,MAAC,QAAD,EAAU,MAAM,CAAEpB,YAAlB,wBACE,oCADF,cAEI,KAAC,OAAD,EAAS,uBAAuB,CAAE,CAACqB,MAAM,CAAEjB,QAAQ,CAACkB,YAAlB,CAAlC,EAFJ,GADF,cAKE,KAAC,YAAD,EAAc,MAAM,CAAEtB,YAAtB,uBACE,KAAC,SAAD,EAAW,OAAO,CAAE,yBAAMC,CAAAA,eAAe,CAAC,CAACD,YAAF,CAArB,EAApB,UAA2DA,YAAY,CAAG,IAAH,CAAU,SAAjF,EADF,EALF,GADF,cAUE,MAAC,WAAD,yBACE,MAAC,QAAD,EAAU,MAAM,CAAEE,YAAlB,wBACE,oCADF,cAEI,KAAC,OAAD,EAAS,uBAAuB,CAAE,CAACmB,MAAM,CAAEjB,QAAQ,CAACmB,MAAlB,CAAlC,EAFJ,GADF,cAKE,KAAC,YAAD,EAAc,MAAM,CAAErB,YAAtB,uBACE,KAAC,SAAD,EAAW,OAAO,CAAE,yBAAMC,CAAAA,eAAe,CAAC,CAACD,YAAF,CAArB,EAApB,UAA2DA,YAAY,CAAG,IAAH,CAAU,SAAjF,EADF,EALF,GAVF,cAmBE,KAAC,WAAD,EAAa,IAAI,CAAE,OAAnB,CAA6B,EAAE,CAAEH,MAAjC,EAnBF,GAdF,GA5BF,GADF,CAmED,CAtGD,CAwGA,cAAeF,CAAAA,IAAf","sourcesContent":["import { useState, useEffect } from 'react'\nimport { useParams } from 'react-router-dom'\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { getSongOnSnapShot, toggleSongLiked } from '../../utils/firebase'\nimport CommentArea from '../../components/CommentArea'\nimport { faHeart, faPlay } from '@fortawesome/free-solid-svg-icons'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { setCurrentSong } from \"../../redux/reducers/songReducer\";\nimport { setMode, setIsPlaying } from \"../../redux/reducers/playerControlReducer\"\nimport { setCurrentTitle } from \"../../redux/reducers/pageTitleReducer\"\nimport {\n  SongPageConatainer,\n  SongInfoCategory,\n  MainInfoBackground,\n  MainInfoContainer,\n  MainImgDiv,\n  MainInfoDiv,\n  MainInfoSongName,\n  MainInfoSongInfoDiv,\n  NumInfo,\n  InfoDesc,\n  InfoDescNum,\n  BodyContainer,\n  MainBodyContainer,\n  FoldSection,\n  FoldInfo,\n  FoldingCover,\n  CoverDesc,\n  Content,\n  ArtistContainer,\n  ArtistInfo,\n  ArtistInfoLeftDiv,\n  ArtistInfoNames,\n  ArtistName,\n  AuthorizedDesc,\n  ArtistImgDiv,\n  ArtistButton,\n  SongUpdate,\n  ButtonsGroup,\n  LikedButtonDiv,\n} from './SongElements.js'\n\n\nconst Song = () => {\n  const dispatch = useDispatch()\n  const { songId } = useParams()\n  const [foldSection1, setFoldSection1] = useState(false)\n  const [foldSection2, setFoldSection2] = useState(false)\n  const [pageData, setPageData] = useState({})\n  const user = useSelector((store) => store.user.currentUser)\n  const isLiked = pageData.likedBy?.includes(user?.uid)\n\n  async function playSong(song){\n    await dispatch(setIsPlaying(true))\n    await dispatch(setCurrentSong(song))\n    await dispatch(setMode(2))\n  }\n\n  function toggleLiked() {\n    if(!user) {\n      alert('請先登入會員才能按讚～')\n      return\n    }\n    toggleSongLiked(isLiked, songId, user.uid)\n  }\n\n  useEffect(() => {\n    getSongOnSnapShot(songId, setPageData)\n  },[songId])\n\n  useEffect(() => {\n    if(!pageData) return\n    dispatch(setCurrentTitle(pageData.name))\n    return () => {\n      dispatch(setCurrentTitle('Indielog'))\n    }\n  },[pageData])\n\n  return (\n    <SongPageConatainer>\n      <MainInfoBackground bgImg={pageData.cover}>\n        <MainInfoContainer>\n          <MainImgDiv><img alt='' src={pageData.cover}/></MainImgDiv>\n          <MainInfoDiv>\n            <MainInfoSongName>{pageData.name}</MainInfoSongName>\n            <SongInfoCategory>Experimental</SongInfoCategory>\n            <MainInfoSongInfoDiv>\n            <NumInfo>\n              <InfoDesc>播放次數</InfoDesc>\n              <InfoDescNum>10,000</InfoDescNum>\n            </NumInfo>\n            <NumInfo>\n              <InfoDesc>喜歡</InfoDesc>\n              <InfoDescNum>{pageData.likedBy?.length}</InfoDescNum>\n            </NumInfo>\n            <ButtonsGroup>\n              <LikedButtonDiv onClick={() => playSong(pageData)}>\n                <FontAwesomeIcon icon={faPlay} />\n              </LikedButtonDiv>\n              <LikedButtonDiv isLiked={isLiked} onClick={toggleLiked}>\n                <FontAwesomeIcon  icon={faHeart} />\n              </LikedButtonDiv>\n            </ButtonsGroup>\n            </MainInfoSongInfoDiv>\n          </MainInfoDiv>\n        </MainInfoContainer>\n      </MainInfoBackground>\n      <BodyContainer>\n        <ArtistContainer>\n        <ArtistInfo>\n          <ArtistInfoLeftDiv>\n            <ArtistImgDiv><img alt='' src={pageData.cover}/></ArtistImgDiv>\n            <ArtistInfoNames>\n              <ArtistName>{pageData.artist}</ArtistName>\n              <AuthorizedDesc>認證創作者</AuthorizedDesc>\n            </ArtistInfoNames>\n          </ArtistInfoLeftDiv>\n          <ArtistButton>＋追蹤</ArtistButton>\n        </ArtistInfo>\n        <SongUpdate>發佈時間 2021-09-15</SongUpdate>\n        </ArtistContainer>\n        <MainBodyContainer>\n          <FoldSection>\n            <FoldInfo isFold={foldSection1}>\n              <h3>介紹</h3>\n                <Content dangerouslySetInnerHTML={{__html: pageData.introduction}} />\n            </FoldInfo>\n            <FoldingCover isFold={foldSection1}>\n              <CoverDesc onClick={() => setFoldSection1(!foldSection1)}>{foldSection1 ? '收合' : '...查看更多'}</CoverDesc>\n            </FoldingCover>\n          </FoldSection>\n          <FoldSection >\n            <FoldInfo isFold={foldSection2}>\n              <h3>歌詞</h3>\n                <Content dangerouslySetInnerHTML={{__html: pageData.lyrics}} />\n            </FoldInfo>\n            <FoldingCover isFold={foldSection2}>\n              <CoverDesc onClick={() => setFoldSection2(!foldSection2)}>{foldSection2 ? '收合' : '...查看更多'}</CoverDesc>\n            </FoldingCover>\n          </FoldSection>\n          <CommentArea area={'songs'}  id={songId}/>\n        </MainBodyContainer>\n      </BodyContainer>\n    </SongPageConatainer>\n  )\n}\n\nexport default Song\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _objectSpread from\"/Users/fanyukun/Documents/react/Indielog/Indielog/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import firebase from'firebase/compat/app';import'firebase/compat/auth';import'firebase/compat/firestore';import'firebase/compat/storage';import config from'./config.js';firebase.initializeApp(config);var db=firebase.firestore();var auth=firebase.auth();var storage=firebase.storage();var usersDb=db.collection('users');var postsDb=db.collection('posts');var songsDb=db.collection('songs');var topicsDb=db.collection('topics');// auth\nexport var signUp=function signUp(email,password,handleSuccess,handleErrMessage){auth.createUserWithEmailAndPassword(email,password).then(function(signUpResult){usersDb.doc(signUpResult.user.uid).set({email:email,photoURL:'',displayName:'',introduction:'',createdAt:firebase.firestore.Timestamp.now()}).then(function(){handleSuccess();}).catch(function(err){switch(err.code){case\"auth/email-already-in-use\":handleErrMessage('信箱已存在');break;case\"auth/invalid-email\":handleErrMessage('信箱格式錯誤');break;case\"auth/weak-password\":handleErrMessage('密碼強度不足');break;default:handleErrMessage(err.code);}});});};export var signIn=function signIn(email,password,handleSuccess,handleErrMessage){auth.signInWithEmailAndPassword(email,password).then(function(){handleSuccess();}).catch(function(err){switch(err.code){case\"auth/invalid-email\":handleErrMessage('信箱格式錯誤');break;case\"auth/user-not-found\":handleErrMessage('信箱不存在');break;case\"auth/wrong-password\":handleErrMessage('密碼錯誤');break;default:handleErrMessage(err.code);}});};export var signOut=function signOut(){auth.signOut();};export var checkUserStatus=function checkUserStatus(handleUser){auth.onAuthStateChanged(function(user){if(user){handleUser({uid:user.uid,displayName:user.displayName,email:user.email,photoURL:user.photoURL});}else{handleUser(null);}});};export var forgetPassword=function forgetPassword(email){return auth.sendPasswordResetEmail(email);};export var getUserInfoOnSnapshot=function getUserInfoOnSnapshot(userId,handleUser){usersDb.doc(userId).onSnapshot(function(userSnapShot){handleUser(userSnapShot.data());});};export var updatePassword=function updatePassword(userEmail,oldPassword,newPassword,handleSuccess,handleErr){var credential=firebase.auth.EmailAuthProvider.credential(userEmail,oldPassword);firebase.auth().currentUser.reauthenticateWithCredential(credential).then(function(){firebase.auth().currentUser.updatePassword(newPassword).then(function(){handleSuccess();}).catch(function(err){handleErr('新密碼錯誤');});}).catch(function(err){handleErr('原密碼錯誤');});};export var updateDisplayName=function updateDisplayName(userId,newDisplayName,handleSuccess,handleError){firebase.auth().currentUser.updateProfile({newDisplayName:newDisplayName}).then(function(){usersDb.doc(userId).update({displayName:newDisplayName}).then(function(){handleSuccess();}).catch(function(err){handleError('修改失敗，請稍後再試');});});};export var updateIntroduction=function updateIntroduction(userId,newIntroduction,handleSuccess,handleError){usersDb.doc(userId).update({introduction:newIntroduction}).then(function(){handleSuccess();}).catch(function(err){handleError('修改失敗，請稍後再試');});};export var updateImage=function updateImage(userId,file,handleSuccess,handleError){var userRef=usersDb.doc(userId);var fileRef=storage.ref('user-avatars/'+userId);var metadata={contentType:file.type};fileRef.put(file,metadata).then(function(){fileRef.getDownloadURL().then(function(imageUrl){auth.currentUser.updateProfile({photoURL:imageUrl}).then(function(){userRef.update({photoURL:imageUrl}).then(function(){handleSuccess();}).catch(function(err){handleError('上傳失敗，請稍後再試');});}).catch(function(err){handleError('上傳失敗，請稍後再試');});}).catch(function(err){handleError('上傳失敗，請稍後再試');});}).catch(function(err){handleError('上傳失敗，請稍後再試');});};// firestore\n// topics\nexport var getTopics=function getTopics(handleTopics){topicsDb.get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleTopics(data);});};export var getTopicsAndSetDefaultTopic=function getTopicsAndSetDefaultTopic(handleTopics,handleCurrentTopic){topicsDb.get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleTopics(data);handleCurrentTopic(data[0].name);});};// posts\nexport var getPost=function getPost(postId,handlePost){postsDb.doc(postId).get().then(function(docSnapShot){handlePost(docSnapShot.data());});};export var getPostWithAuthorInfo=function getPostWithAuthorInfo(postId,handlePost,handleAuthorInfo){postsDb.doc(postId).onSnapshot(function(docSnapShot){var data=docSnapShot.data();handlePost(data);usersDb.doc(data.author.uid).get().then(function(userSnapShot){handleAuthorInfo(userSnapShot.data());});});};export var getSeedPosts=function getSeedPosts(topic,limit,handlePosts){if(!topic){postsDb.orderBy('createdAt','desc').limit(limit).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});}else{postsDb.orderBy('createdAt','desc').where('topic','==',topic).limit(limit).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});}};export var getChangePagePosts=function getChangePagePosts(topic,limit,handlePosts,lastRefPlace){if(!topic){postsDb.orderBy('createdAt','desc').get().then(function(collectionSnapShot){var ref=collectionSnapShot.docs[lastRefPlace];postsDb.orderBy('createdAt','desc').startAt(ref).limit(limit).get().then(function(snapshot){var data=snapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});});}else{postsDb.orderBy('createdAt','desc').where('topic','==',topic).get().then(function(collectionSnapShot){var ref=collectionSnapShot.docs[lastRefPlace];postsDb.orderBy('createdAt','desc').limit(limit).startAt(ref).get().then(function(snapshot){var data=snapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});});}};export var getPostsAmount=function getPostsAmount(topic,limit,handlePosts){if(!topic){postsDb.get().then(function(collectionSnapShot){var amount=collectionSnapShot.size;var pages=amount%limit===0?amount/limit:Math.ceil(amount/limit);handlePosts(pages);});}else{postsDb.where('topic','==',topic).get().then(function(collectionSnapShot){var amount=collectionSnapShot.size;var pages=amount%limit===0?amount/limit:Math.ceil(amount/limit);handlePosts(pages);});}};export var addNewPost=function addNewPost(image,postInfo,handleSuccess){var documentRef=postsDb.doc();var imageRef=storage.ref('post-images/'+documentRef.id);var metadata={contentType:image.type};imageRef.put(image,metadata).then(function(){imageRef.getDownloadURL().then(function(imageUrl){documentRef.set({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,createdAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId},imageUrl:imageUrl});handleSuccess(documentRef.id);});});};export var updatePost=function updatePost(postId,postInfo,handleSuccess){var documentRef=postsDb.doc(postId);documentRef.update({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,updatedAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId}}).then(function(){handleSuccess(postId);});};export var updatePostWithNewPic=function updatePostWithNewPic(postId,image,postInfo,handleSuccess){var documentRef=postsDb.doc(postId);var imageRef=storage.ref('post-images/'+documentRef.id);var metadata={contentType:image.type};imageRef.put(image,metadata).then(function(){imageRef.getDownloadURL().then(function(imageUrl){documentRef.update({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,updatedAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId},imageUrl:imageUrl});handleSuccess(documentRef.id);});});};export var getMyPostsOnSnapshot=function getMyPostsOnSnapshot(userId,handlePosts){postsDb.where('author.uid','==',userId).onSnapshot(function(collectionSnapshot){var data=collectionSnapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});};export var togglePostLiked=function togglePostLiked(isLiked,postId,userId){if(isLiked){var _firebase$firestore$F;postsDb.doc(postId).update({likedBy:(_firebase$firestore$F=firebase.firestore.FieldValue)===null||_firebase$firestore$F===void 0?void 0:_firebase$firestore$F.arrayRemove(userId)});}else{var _firebase$firestore$F2;postsDb.doc(postId).update({likedBy:(_firebase$firestore$F2=firebase.firestore.FieldValue)===null||_firebase$firestore$F2===void 0?void 0:_firebase$firestore$F2.arrayUnion(userId)});}};export var getLikedPosts=function getLikedPosts(userId,handlePosts){postsDb.where('likedBy','array-contains',userId).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});};export var deletePost=function deletePost(postId){postsDb.doc(postId).delete().then(function(){alert('已刪除文章');});};// authors\nexport var getAuthorInfo=function getAuthorInfo(authorId,handleAuthorInfo){usersDb.doc(authorId).get().then(function(userSnapShot){handleAuthorInfo(userSnapShot.data());});};// comments\nexport var getCommentsOnSnapshot=function getCommentsOnSnapshot(area,id,handleComments){db.collection(area).doc(id).collection('comments').orderBy('createdAt','asc').onSnapshot(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return{id:id,authorUid:doc.data().authorUid,content:doc.data().content,createdAt:doc.data().createdAt};});handleComments(data);});};export var addNewComment=function addNewComment(area,id,commentContent,authorId){return db.collection(area).doc(id).collection('comments').doc().set({content:commentContent,createdAt:firebase.firestore.Timestamp.now(),authorUid:authorId});};// songs\nexport var getLikedSongs=function getLikedSongs(userId,handleSongs){songsDb.where('likedBy','array-contains',userId).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleSongs(data);});};export var getSongsOnSnapShot=function getSongsOnSnapShot(handleSongs){songsDb.onSnapshot(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleSongs(data);});};export var toggleSongLiked=function toggleSongLiked(isLiked,songId,userId){if(isLiked){var _firebase$firestore$F3;songsDb.doc(songId).update({likedBy:(_firebase$firestore$F3=firebase.firestore.FieldValue)===null||_firebase$firestore$F3===void 0?void 0:_firebase$firestore$F3.arrayRemove(userId)});}else{var _firebase$firestore$F4;songsDb.doc(songId).update({likedBy:(_firebase$firestore$F4=firebase.firestore.FieldValue)===null||_firebase$firestore$F4===void 0?void 0:_firebase$firestore$F4.arrayUnion(userId)});}};export var getSongOnSnapShot=function getSongOnSnapShot(songId,handleSong){songsDb.doc(songId).onSnapshot(function(docSnapshot){return handleSong(docSnapshot.data());});};export default firebase;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/Indielog/Indielog/src/utils/firebase.js"],"names":["firebase","config","initializeApp","db","firestore","auth","storage","usersDb","collection","postsDb","songsDb","topicsDb","signUp","email","password","handleSuccess","handleErrMessage","createUserWithEmailAndPassword","then","signUpResult","doc","user","uid","set","photoURL","displayName","introduction","createdAt","Timestamp","now","catch","err","code","signIn","signInWithEmailAndPassword","signOut","checkUserStatus","handleUser","onAuthStateChanged","forgetPassword","sendPasswordResetEmail","getUserInfoOnSnapshot","userId","onSnapshot","userSnapShot","data","updatePassword","userEmail","oldPassword","newPassword","handleErr","credential","EmailAuthProvider","currentUser","reauthenticateWithCredential","updateDisplayName","newDisplayName","handleError","updateProfile","update","updateIntroduction","newIntroduction","updateImage","file","userRef","fileRef","ref","metadata","contentType","type","put","getDownloadURL","imageUrl","getTopics","handleTopics","get","collectionSnapShot","docs","map","id","getTopicsAndSetDefaultTopic","handleCurrentTopic","name","getPost","postId","handlePost","docSnapShot","getPostWithAuthorInfo","handleAuthorInfo","author","getSeedPosts","topic","limit","handlePosts","orderBy","where","getChangePagePosts","lastRefPlace","startAt","snapshot","getPostsAmount","amount","size","pages","Math","ceil","addNewPost","image","postInfo","documentRef","imageRef","title","content","updatePost","updatedAt","updatePostWithNewPic","getMyPostsOnSnapshot","collectionSnapshot","togglePostLiked","isLiked","likedBy","FieldValue","arrayRemove","arrayUnion","getLikedPosts","deletePost","delete","alert","getAuthorInfo","authorId","getCommentsOnSnapshot","area","handleComments","authorUid","addNewComment","commentContent","getLikedSongs","handleSongs","getSongsOnSnapShot","toggleSongLiked","songId","getSongOnSnapShot","handleSong","docSnapshot"],"mappings":"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","sourcesContent":["import firebase from 'firebase/compat/app'\nimport 'firebase/compat/auth'\nimport 'firebase/compat/firestore'\nimport 'firebase/compat/storage'\nimport config from './config.js'\n\nfirebase.initializeApp(config);\n\nconst db = firebase.firestore();\nconst auth = firebase.auth();\nconst storage = firebase.storage()\nconst usersDb = db.collection('users')\nconst postsDb = db.collection('posts')\nconst songsDb = db.collection('songs')\nconst topicsDb = db.collection('topics')\n\n\n// auth\nexport const signUp = (email, password, handleSuccess, handleErrMessage) => {\n  auth.createUserWithEmailAndPassword(email, password).then((signUpResult) => {\n    usersDb.doc(signUpResult.user.uid).set({\n      email,\n      photoURL: '',\n      displayName: '',\n      introduction: '',\n      createdAt: firebase.firestore.Timestamp.now()\n    }).then(() => {\n      handleSuccess()\n    }).catch((err) => {\n      switch(err.code) {\n        case \"auth/email-already-in-use\":\n          handleErrMessage('信箱已存在')\n          break\n        case \"auth/invalid-email\":\n          handleErrMessage('信箱格式錯誤')\n          break\n        case \"auth/weak-password\":\n          handleErrMessage('密碼強度不足')\n          break\n        default:\n          handleErrMessage(err.code)\n      }\n    })\n  })\n}\n\nexport const signIn = (email, password, handleSuccess, handleErrMessage) => {\n  auth.signInWithEmailAndPassword(email, password).then(() => {\n    handleSuccess()\n  }).catch((err) => {\n    switch(err.code) {\n      case \"auth/invalid-email\":\n        handleErrMessage('信箱格式錯誤')\n        break\n      case \"auth/user-not-found\":\n        handleErrMessage('信箱不存在')\n        break\n      case \"auth/wrong-password\":\n        handleErrMessage('密碼錯誤')\n        break\n      default:\n        handleErrMessage(err.code)\n    }\n  })\n}\n\nexport const signOut = () => {\n  auth.signOut()\n}\n\nexport const checkUserStatus = (handleUser) => {\n  auth.onAuthStateChanged((user) => {\n    if(user) {\n      handleUser({\n        uid: user.uid,\n        displayName: user.displayName,\n        email: user.email,\n        photoURL: user.photoURL\n      })\n    } else {\n      handleUser(null)\n    }\n  })\n}\n\nexport const forgetPassword = (email) => {\n  return auth.sendPasswordResetEmail(email)\n}\n\n\nexport const getUserInfoOnSnapshot = (userId, handleUser) => {\n  usersDb.doc(userId).onSnapshot((userSnapShot) => {\n    handleUser(userSnapShot.data())\n  })\n}\n\nexport const updatePassword = (userEmail, oldPassword, newPassword, handleSuccess, handleErr) => {\n  const credential = firebase.auth.EmailAuthProvider.credential(userEmail, oldPassword)\n  firebase.auth().currentUser.reauthenticateWithCredential(credential).then(() => {\n    firebase.auth().currentUser.updatePassword(newPassword).then(() => {\n      handleSuccess()\n    }).catch((err) => {\n      handleErr('新密碼錯誤')\n    })\n  }).catch((err) => {\n    handleErr('原密碼錯誤')\n  })\n}\n\nexport const updateDisplayName = (userId, newDisplayName, handleSuccess, handleError) => {\n  firebase.auth().currentUser.updateProfile({\n    newDisplayName,\n  }).then(() => {\n    usersDb.doc(userId).update({\n        displayName: newDisplayName,\n      }).then(() => {\n        handleSuccess()\n      }).catch(err => {\n        handleError('修改失敗，請稍後再試')\n      })\n  })\n}\n\nexport const updateIntroduction = (userId, newIntroduction, handleSuccess, handleError) => {\n  usersDb.doc(userId).update({\n    introduction: newIntroduction\n  }).then(() => {\n    handleSuccess()\n  }).catch(err => {\n    handleError('修改失敗，請稍後再試')\n  })\n}\n\nexport const updateImage = (userId, file, handleSuccess, handleError) => {\n  const userRef = usersDb.doc(userId)\n  const fileRef = storage.ref('user-avatars/' + userId)\n  const metadata = {\n    contentType: file.type\n  }\n  fileRef.put(file, metadata).then(() => {\n    fileRef.getDownloadURL().then((imageUrl) => {\n      auth.currentUser.updateProfile({\n        photoURL:imageUrl\n      }).then(() => {\n        userRef.update({\n          photoURL:imageUrl,\n        })\n        .then(() => {\n          handleSuccess()\n        }).catch(err => {\n          handleError('上傳失敗，請稍後再試')\n        })\n      }).catch(err => {\n        handleError('上傳失敗，請稍後再試')\n      })\n    }).catch(err => {\n      handleError('上傳失敗，請稍後再試')\n    })\n  }).catch(err => {\n    handleError('上傳失敗，請稍後再試')\n  })\n}\n\n// firestore\n// topics\nexport const getTopics = (handleTopics) => {\n  topicsDb.get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleTopics(data)\n  })\n}\n\nexport const getTopicsAndSetDefaultTopic = (handleTopics, handleCurrentTopic) => {\n  topicsDb.get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleTopics(data)\n    handleCurrentTopic(data[0].name)\n  })\n}\n\n// posts\nexport const getPost = (postId, handlePost) => {\n  postsDb.doc(postId).get().then((docSnapShot) => {\n    handlePost(docSnapShot.data())\n  })\n}\n\nexport const getPostWithAuthorInfo = (postId, handlePost, handleAuthorInfo) => {\n  postsDb.doc(postId).onSnapshot((docSnapShot) => {\n    const data = docSnapShot.data()\n    handlePost(data)\n    usersDb.doc(data.author.uid).get().then((userSnapShot) => {\n      handleAuthorInfo(userSnapShot.data())\n    })\n  })\n}\n\nexport const getSeedPosts = (topic, limit, handlePosts) => {\n  if(!topic) {\n    postsDb.orderBy('createdAt','desc').limit(limit).get().then((collectionSnapShot) => {\n      const data = collectionSnapShot.docs.map((doc) => {\n        const id = doc.id\n        return {...doc.data(),id}\n      })\n      handlePosts(data)\n    })\n  } else {\n    postsDb.orderBy('createdAt','desc').where('topic','==',topic).limit(limit).get().then((collectionSnapShot) => {\n      const data = collectionSnapShot.docs.map((doc) => {\n        const id = doc.id\n        return {...doc.data(),id}\n      })\n      handlePosts(data)\n    })\n  }\n}\n\nexport const getChangePagePosts = (topic, limit, handlePosts, lastRefPlace) => {\n  if(!topic) {\n    postsDb.orderBy('createdAt','desc').get().then((collectionSnapShot) => {\n      const ref = collectionSnapShot.docs[lastRefPlace]\n      postsDb.orderBy('createdAt','desc').startAt(ref).limit(limit).get().then(snapshot => {\n        const data = snapshot.docs.map((doc) => {\n          const id = doc.id\n          return {...doc.data(),id}\n        })\n        handlePosts(data)\n      })\n    })\n  } else {\n    postsDb.orderBy('createdAt','desc').where('topic','==',topic).get().then((collectionSnapShot) => {\n      const ref = collectionSnapShot.docs[lastRefPlace]\n      postsDb.orderBy('createdAt','desc').limit(limit).startAt(ref).get().then(snapshot => {\n        const data = snapshot.docs.map((doc) => {\n          const id = doc.id\n          return {...doc.data(),id}\n        })\n        handlePosts(data)\n      })\n    })\n  }\n}\n\nexport const getPostsAmount = (topic, limit, handlePosts) => {\n  if(!topic) {\n    postsDb.get().then(collectionSnapShot => {\n      const amount = collectionSnapShot.size\n      const pages = amount % limit === 0 ? amount / limit : Math.ceil(amount / limit);\n      handlePosts(pages)\n    })\n  } else {\n    postsDb.where('topic','==',topic).get().then(collectionSnapShot => {\n      const amount = collectionSnapShot.size\n      const pages = amount % limit === 0 ? amount / limit : Math.ceil(amount / limit);\n      handlePosts(pages)\n    })\n  }\n\n}\n\nexport const addNewPost = (image, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc()\n  const imageRef = storage.ref('post-images/' + documentRef.id)\n  const metadata = {\n    contentType: image.type\n  }\n\n  imageRef.put(image, metadata).then(() => {\n    imageRef.getDownloadURL().then((imageUrl) => {\n      documentRef.set({\n        title: postInfo.title,\n        content: postInfo.content,\n        topic: postInfo.topic,\n        createdAt: firebase.firestore.Timestamp.now(),\n        author: {\n          uid: postInfo.userId,\n        },\n        imageUrl\n      })\n      handleSuccess(documentRef.id)\n    })\n  })\n}\n\nexport const updatePost = (postId, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc(postId)\n  documentRef.update({\n    title: postInfo.title,\n    content: postInfo.content,\n    topic: postInfo.topic,\n    updatedAt: firebase.firestore.Timestamp.now(),\n    author: {\n      uid: postInfo.userId,\n    }\n    }).then(() => {\n      handleSuccess(postId)\n    })\n}\n\nexport const updatePostWithNewPic = (postId, image, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc(postId)\n  const imageRef = storage.ref('post-images/' + documentRef.id)\n  const metadata = {\n    contentType: image.type\n  }\n\n  imageRef.put(image, metadata).then(() => {\n    imageRef.getDownloadURL().then((imageUrl) => {\n      documentRef.update({\n        title: postInfo.title,\n        content: postInfo.content,\n        topic: postInfo.topic,\n        updatedAt: firebase.firestore.Timestamp.now(),\n        author: {\n          uid: postInfo.userId,\n        },\n        imageUrl\n      })\n      handleSuccess(documentRef.id)\n    })\n  })\n}\n\nexport const getMyPostsOnSnapshot = (userId, handlePosts) => {\n  postsDb.where('author.uid','==', userId).onSnapshot((collectionSnapshot) => {\n    const data = collectionSnapshot.docs.map((doc) => {\n      const id = doc.id\n      return { ...doc.data(), id }\n    })\n    handlePosts(data)\n  })\n}\n\nexport const togglePostLiked = (isLiked, postId, userId) => {\n  if(isLiked) {\n    postsDb.doc(postId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayRemove(userId)\n    })\n  } else {\n    postsDb.doc(postId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayUnion(userId)\n    })\n  }\n}\n\nexport const getLikedPosts = (userId, handlePosts) => {\n  postsDb.where('likedBy', 'array-contains', userId).get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handlePosts(data)\n  })\n}\n\nexport const deletePost = (postId) => {\n  postsDb.doc(postId).delete().then(() => {\n    alert('已刪除文章')\n  })\n}\n\n// authors\nexport const getAuthorInfo = (authorId, handleAuthorInfo) => {\n  usersDb.doc(authorId).get().then((userSnapShot) => {\n    handleAuthorInfo(userSnapShot.data())\n  })\n}\n\n// comments\nexport const getCommentsOnSnapshot = (area, id, handleComments) => {\n  db.collection(area).doc(id).collection('comments').orderBy('createdAt','asc').onSnapshot((collectionSnapShot) => {\n     const data = collectionSnapShot.docs.map((doc) => {\n       const id = doc.id\n       return {\n         id,\n         authorUid: doc.data().authorUid,\n         content: doc.data().content,\n         createdAt: doc.data().createdAt\n       }\n     })\n     handleComments(data)\n  })\n}\n\nexport const addNewComment = (area, id, commentContent, authorId) => {\n  return db.collection(area).doc(id).collection('comments').doc().set({\n    content: commentContent,\n    createdAt: firebase.firestore.Timestamp.now(),\n    authorUid: authorId,\n  })\n}\n\n// songs\nexport const getLikedSongs = (userId, handleSongs) => {\n  songsDb.where('likedBy', 'array-contains', userId).get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleSongs(data)\n  })\n}\n\nexport const getSongsOnSnapShot = (handleSongs) => {\n  songsDb.onSnapshot((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleSongs(data)\n  })\n}\n\nexport const toggleSongLiked = (isLiked, songId, userId) => {\n  if(isLiked) {\n    songsDb.doc(songId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayRemove(userId)\n    })\n  } else {\n    songsDb.doc(songId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayUnion(userId)\n    })\n  }\n}\n\nexport const getSongOnSnapShot = (songId, handleSong) => {\n  songsDb.doc(songId).onSnapshot((docSnapshot) => handleSong(docSnapshot.data()))\n}\n\nexport default firebase\n"]},"metadata":{},"sourceType":"module"}
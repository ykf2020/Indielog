{"ast":null,"code":"import _slicedToArray from\"/Users/fanyukun/Documents/react/Indielog/Indielog/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{faPen}from'@fortawesome/free-solid-svg-icons';import{FontAwesomeIcon}from'@fortawesome/react-fontawesome';import{useSelector}from'react-redux';import{getUserInfoOnSnapshot,updatePassword,updateDisplayName,updateIntroduction,updateImage}from'../../utils/firebase.js';import'firebase/compat/auth';import\"firebase/compat/firestore\";import\"firebase/compat/storage\";import{MemberPageContainer,TitleButtonsGroup,TitleNormalButton,TitleActiveButton,TitleDiv,PersonalInfoContainer,InfoSection,InfoTitle,InfoElementTitle,InfoElementMainDiv,ImgDiv,EditButton,Input,IntroductionArea,IntroductionDiv,ModalBackground,ModalPanel,ModalInnerTop,ModalInnerDiv,ModalInnerBottom,ModalButton,ModalImgDiv,ModalUploadButton,ModalTextArea,Warning}from'./PersonalInfoElements.js';import Loading from'../../components/Loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PersonalInfo=function PersonalInfo(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modalIsOpen=_useState6[0],setModalIsOpen=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),mode=_useState8[0],setMode=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),introduction=_useState10[0],setIntroduction=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),displayName=_useState12[0],setDisplayName=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),file=_useState14[0],setFile=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),currentPassword=_useState16[0],setCurrentPassword=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),newPassword=_useState18[0],setNewPassword=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),newPasswordConfirm=_useState20[0],setNewPasswordConfirm=_useState20[1];var _useState21=useState({}),_useState22=_slicedToArray(_useState21,2),shownInfo=_useState22[0],setShownInfo=_useState22[1];var previewUrl=file?URL.createObjectURL(file):'/image.png';var user=useSelector(function(store){return store.user.currentUser;});function handleUpdateAvatar(){function handleUpdateSucceed(){setModalIsOpen(false);setFile(null);setIsLoading(false);}setIsLoading(true);updateImage(user.uid,file,handleUpdateSucceed,setErrorMessage);}function handleEditIntroduction(){if(introduction===''){setErrorMessage('請填入欄位');return;}function handleUpdateSucceed(){setModalIsOpen(false);setIntroduction(null);setIsLoading(false);}setIsLoading(true);updateIntroduction(user.uid,introduction,handleUpdateSucceed,setErrorMessage);}function handleEditDisplayName(){if(displayName===''){setErrorMessage('請填入欄位');return;}function handleUpdateSucceed(){setModalIsOpen(false);setDisplayName(null);setIsLoading(false);}setIsLoading(true);updateDisplayName(user.uid,displayName,handleUpdateSucceed,setErrorMessage);}function handleChangePssword(){if(!newPassword||!newPasswordConfirm||!currentPassword){setErrorMessage('請填入所有欄位');return;}if(newPassword!==newPasswordConfirm){setErrorMessage('請確認新密碼輸入正確');return;}function handleUpdateSucceed(){setModalIsOpen(false);setIsLoading(false);setCurrentPassword('');setNewPassword('');setNewPasswordConfirm('');alert('修改密碼成功');}setIsLoading(true);updatePassword(user.email,currentPassword,newPassword,handleUpdateSucceed,setErrorMessage);}useEffect(function(){getUserInfoOnSnapshot(user.uid,setShownInfo);},[]);return/*#__PURE__*/_jsxs(MemberPageContainer,{children:[isLoading&&/*#__PURE__*/_jsx(Loading,{}),/*#__PURE__*/_jsxs(TitleButtonsGroup,{children:[/*#__PURE__*/_jsx(TitleActiveButton,{children:\"\\u6703\\u54E1\\u8CC7\\u6599\"}),/*#__PURE__*/_jsx(TitleNormalButton,{to:\"/member/myposts\",children:\"\\u6211\\u7684\\u6587\\u7AE0\"})]}),/*#__PURE__*/_jsxs(PersonalInfoContainer,{children:[/*#__PURE__*/_jsx(TitleDiv,{children:/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u57FA\\u672C\\u8CC7\\u6599\"})}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u982D\\u50CF\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(ImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:shownInfo.photoURL?shownInfo.photoURL:'/default-user-image.png'})}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(1);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u5E33\\u865F\"}),/*#__PURE__*/_jsx(InfoElementMainDiv,{children:/*#__PURE__*/_jsx(Input,{disabled:true,value:shownInfo.email})})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(Input,{disabled:true,value:'******'}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(2);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u66B1\\u7A31\"}),/*#__PURE__*/_jsxs(InfoElementMainDiv,{children:[/*#__PURE__*/_jsx(Input,{disabled:true,value:shownInfo.displayName}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(3);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),/*#__PURE__*/_jsxs(InfoSection,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u81EA\\u6211\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsxs(IntroductionDiv,{children:[/*#__PURE__*/_jsx(IntroductionArea,{children:shownInfo.introduction?shownInfo.introduction:'尚未新增自我介紹'}),/*#__PURE__*/_jsx(EditButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(4);},children:/*#__PURE__*/_jsx(FontAwesomeIcon,{size:\"1x\",icon:faPen})})]})]}),modalIsOpen&&/*#__PURE__*/_jsxs(ModalBackground,{children:[mode===1&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u982D\\u50CF\"}),/*#__PURE__*/_jsxs(ModalInnerTop,{children:[/*#__PURE__*/_jsx(ModalImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:previewUrl})}),/*#__PURE__*/_jsx(ModalUploadButton,{htmlFor:\"post-image\",children:\"\\u4E0A\\u50B3\\u5716\\u7247\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"post-image\",style:{display:'none'},onChange:function onChange(e){return setFile(e.target.files[0]);}})]}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){handleUpdateAvatar();},children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===2&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsxs(ModalInnerTop,{children:[errorMessage&&/*#__PURE__*/_jsx(Warning,{children:errorMessage}),/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u76EE\\u524D\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{value:currentPassword,onChange:function onChange(e){return setCurrentPassword(e.target.value);}})]}),/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{value:newPassword,onChange:function onChange(e){return setNewPassword(e.target.value);}})]}),/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u518D\\u6B21\\u8F38\\u5165\\u65B0\\u5BC6\\u78BC\"}),/*#__PURE__*/_jsx(Input,{value:newPasswordConfirm,onChange:function onChange(e){return setNewPasswordConfirm(e.target.value);}})]})]}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:handleChangePssword,children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===3&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u66B1\\u7A31\"}),errorMessage&&/*#__PURE__*/_jsx(Warning,{children:errorMessage}),/*#__PURE__*/_jsx(ModalInnerTop,{children:/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u65B0\\u66B1\\u7A31\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"\\u9650\\u516B\\u500B\\u5B57\\u5143\\u4EE5\\u5167\",value:displayName,onChange:function onChange(e){return setDisplayName(e.target.value);}})]})}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:handleEditDisplayName,children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]}),mode===4&&/*#__PURE__*/_jsxs(ModalPanel,{children:[/*#__PURE__*/_jsx(InfoTitle,{children:\"\\u4FEE\\u6539\\u81EA\\u6211\\u4ECB\\u7D39\"}),errorMessage&&/*#__PURE__*/_jsx(Warning,{children:errorMessage}),/*#__PURE__*/_jsx(ModalInnerTop,{children:/*#__PURE__*/_jsxs(ModalInnerDiv,{children:[/*#__PURE__*/_jsx(InfoElementTitle,{children:\"\\u8F38\\u5165\\u81EA\\u6211\\u4ECB\\u7D39\"}),/*#__PURE__*/_jsx(ModalTextArea,{value:introduction,onChange:function onChange(e){setIntroduction(e.target.value);}})]})}),/*#__PURE__*/_jsxs(ModalInnerBottom,{children:[/*#__PURE__*/_jsx(ModalButton,{onClick:handleEditIntroduction,children:\"\\u9001\\u51FA\"}),/*#__PURE__*/_jsx(ModalButton,{onClick:function onClick(){setModalIsOpen(!modalIsOpen);setMode(0);},children:\"\\u53D6\\u6D88\"})]})]})]})]})]});};export default PersonalInfo;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/Indielog/Indielog/src/pages/PersonalInfo/index.js"],"names":["useState","useEffect","faPen","FontAwesomeIcon","useSelector","getUserInfoOnSnapshot","updatePassword","updateDisplayName","updateIntroduction","updateImage","MemberPageContainer","TitleButtonsGroup","TitleNormalButton","TitleActiveButton","TitleDiv","PersonalInfoContainer","InfoSection","InfoTitle","InfoElementTitle","InfoElementMainDiv","ImgDiv","EditButton","Input","IntroductionArea","IntroductionDiv","ModalBackground","ModalPanel","ModalInnerTop","ModalInnerDiv","ModalInnerBottom","ModalButton","ModalImgDiv","ModalUploadButton","ModalTextArea","Warning","Loading","PersonalInfo","isLoading","setIsLoading","errorMessage","setErrorMessage","modalIsOpen","setModalIsOpen","mode","setMode","introduction","setIntroduction","displayName","setDisplayName","file","setFile","currentPassword","setCurrentPassword","newPassword","setNewPassword","newPasswordConfirm","setNewPasswordConfirm","shownInfo","setShownInfo","previewUrl","URL","createObjectURL","user","store","currentUser","handleUpdateAvatar","handleUpdateSucceed","uid","handleEditIntroduction","handleEditDisplayName","handleChangePssword","alert","email","photoURL","display","e","target","files","value"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { faPen } from '@fortawesome/free-solid-svg-icons'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { useSelector } from 'react-redux'\nimport { getUserInfoOnSnapshot, updatePassword, updateDisplayName, updateIntroduction, updateImage } from '../../utils/firebase.js'\nimport 'firebase/compat/auth'\nimport \"firebase/compat/firestore\"\nimport \"firebase/compat/storage\"\nimport {\n  MemberPageContainer,\n  TitleButtonsGroup,\n  TitleNormalButton,\n  TitleActiveButton,\n  TitleDiv,\n  PersonalInfoContainer,\n  InfoSection,\n  InfoTitle,\n  InfoElementTitle,\n  InfoElementMainDiv,\n  ImgDiv,\n  EditButton,\n  Input,\n  IntroductionArea,\n  IntroductionDiv,\n  ModalBackground,\n  ModalPanel,\n  ModalInnerTop,\n  ModalInnerDiv,\n  ModalInnerBottom,\n  ModalButton,\n  ModalImgDiv,\n  ModalUploadButton,\n  ModalTextArea,\n  Warning,\n} from './PersonalInfoElements.js'\nimport Loading from '../../components/Loading'\n\nconst PersonalInfo = () => {\n  const [isLoading, setIsLoading] = useState(false)\n  const [errorMessage, setErrorMessage] = useState('')\n  const [modalIsOpen, setModalIsOpen] = useState(false)\n  const [mode, setMode] = useState(0)\n  const [introduction, setIntroduction] = useState('')\n  const [displayName, setDisplayName] = useState('')\n  const [file, setFile] = useState(null)\n  const [currentPassword, setCurrentPassword] = useState('')\n  const [newPassword, setNewPassword] = useState('')\n  const [newPasswordConfirm, setNewPasswordConfirm] = useState('')\n  const [shownInfo, setShownInfo] = useState({})\n  const previewUrl = file ? URL.createObjectURL(file) : '/image.png'\n  const user = useSelector((store) => store.user.currentUser)\n\n  function handleUpdateAvatar() {\n    function handleUpdateSucceed(){\n      setModalIsOpen(false)\n      setFile(null)\n      setIsLoading(false)\n    }\n    setIsLoading(true)\n    updateImage(user.uid, file, handleUpdateSucceed, setErrorMessage)\n  }\n\n  function handleEditIntroduction() {\n    if(introduction === '') {\n      setErrorMessage('請填入欄位')\n      return\n    }\n    function handleUpdateSucceed(){\n      setModalIsOpen(false)\n      setIntroduction(null)\n      setIsLoading(false)\n    }\n    setIsLoading(true)\n    updateIntroduction(user.uid, introduction, handleUpdateSucceed, setErrorMessage)\n  }\n\n  function handleEditDisplayName() {\n    if(displayName === '') {\n      setErrorMessage('請填入欄位')\n      return\n    }\n    function handleUpdateSucceed(){\n      setModalIsOpen(false)\n      setDisplayName(null)\n      setIsLoading(false)\n    }\n    setIsLoading(true)\n    updateDisplayName(user.uid, displayName, handleUpdateSucceed, setErrorMessage)\n  }\n\n  function handleChangePssword(){\n    if(!newPassword || !newPasswordConfirm || !currentPassword){\n      setErrorMessage('請填入所有欄位')\n      return\n    }\n    if(newPassword !== newPasswordConfirm) {\n      setErrorMessage('請確認新密碼輸入正確')\n      return\n    }\n\n    function handleUpdateSucceed(){\n      setModalIsOpen(false)\n      setIsLoading(false)\n      setCurrentPassword('')\n      setNewPassword('')\n      setNewPasswordConfirm('')\n      alert('修改密碼成功')\n    }\n    setIsLoading(true)\n    updatePassword(user.email, currentPassword, newPassword, handleUpdateSucceed, setErrorMessage)\n  }\n\n  useEffect(() => {\n    getUserInfoOnSnapshot(user.uid, setShownInfo)\n  },[])\n\n  return (\n      <MemberPageContainer>\n        {isLoading && <Loading />}\n        <TitleButtonsGroup>\n          <TitleActiveButton>會員資料</TitleActiveButton>\n          <TitleNormalButton to='/member/myposts'>我的文章</TitleNormalButton>\n        </TitleButtonsGroup>\n        <PersonalInfoContainer>\n          <TitleDiv><InfoTitle>基本資料</InfoTitle></TitleDiv>\n          <InfoSection>\n            <InfoElementTitle>頭像</InfoElementTitle>\n            <InfoElementMainDiv>\n              <ImgDiv><img alt='' src={shownInfo.photoURL ? shownInfo.photoURL : '/default-user-image.png'}/></ImgDiv>\n              <EditButton\n                onClick={() => {setModalIsOpen(!modalIsOpen);setMode(1)}}>\n                <FontAwesomeIcon size='1x' icon={faPen}/>\n              </EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>帳號</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={shownInfo.email}/>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>密碼</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={'******'}/>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(2)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>暱稱</InfoElementTitle>\n            <InfoElementMainDiv>\n              <Input disabled value={shownInfo.displayName}/>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(3)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </InfoElementMainDiv>\n          </InfoSection>\n          <InfoSection>\n            <InfoElementTitle>自我介紹</InfoElementTitle>\n            <IntroductionDiv>\n              <IntroductionArea>{shownInfo.introduction ? shownInfo.introduction : '尚未新增自我介紹'}</IntroductionArea>\n              <EditButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(4)}}><FontAwesomeIcon size='1x' icon={faPen}/></EditButton>\n            </IntroductionDiv>\n          </InfoSection>\n          {modalIsOpen &&\n            <ModalBackground>\n              {mode === 1 &&\n                <ModalPanel>\n                  <InfoTitle>修改頭像</InfoTitle>\n                  <ModalInnerTop>\n                    <ModalImgDiv><img alt='' src={previewUrl}/></ModalImgDiv>\n                    <ModalUploadButton htmlFor='post-image'>上傳圖片</ModalUploadButton>\n                    <input\n                    type=\"file\"\n                    id='post-image'\n                    style={{display: 'none'}}\n                    onChange={(e) => setFile(e.target.files[0])}/>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={() => {handleUpdateAvatar()}}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 2 &&\n                <ModalPanel>\n                  <InfoTitle>修改密碼</InfoTitle>\n                  <ModalInnerTop>\n                  {errorMessage && <Warning>{errorMessage}</Warning>}\n                  <ModalInnerDiv>\n                    <InfoElementTitle>輸入目前密碼</InfoElementTitle>\n                    <Input value={currentPassword} onChange={(e) => setCurrentPassword(e.target.value)}/>\n                  </ModalInnerDiv>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入新密碼</InfoElementTitle>\n                      <Input value={newPassword} onChange={(e) => setNewPassword(e.target.value)}/>\n                    </ModalInnerDiv>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>再次輸入新密碼</InfoElementTitle>\n                      <Input value={newPasswordConfirm} onChange={(e) => setNewPasswordConfirm(e.target.value)}/>\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={handleChangePssword}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 3 &&\n                <ModalPanel>\n                  <InfoTitle>修改暱稱</InfoTitle>\n                  {errorMessage && <Warning>{errorMessage}</Warning>}\n                  <ModalInnerTop>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入新暱稱</InfoElementTitle>\n                      <Input placeholder='限八個字元以內' value={displayName} onChange={(e) => setDisplayName(e.target.value)}/>\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={handleEditDisplayName}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n              {mode === 4 &&\n                <ModalPanel>\n                  <InfoTitle>修改自我介紹</InfoTitle>\n                  {errorMessage && <Warning>{errorMessage}</Warning>}\n                  <ModalInnerTop>\n                    <ModalInnerDiv>\n                      <InfoElementTitle>輸入自我介紹</InfoElementTitle>\n                      <ModalTextArea value={introduction} onChange={(e) => {setIntroduction(e.target.value)}}/>\n                    </ModalInnerDiv>\n                  </ModalInnerTop>\n                  <ModalInnerBottom>\n                    <ModalButton onClick={handleEditIntroduction}>送出</ModalButton>\n                    <ModalButton onClick={() => {setModalIsOpen(!modalIsOpen);setMode(0)}}>取消</ModalButton>\n                  </ModalInnerBottom>\n                </ModalPanel>\n              }\n            </ModalBackground>\n          }\n        </PersonalInfoContainer>\n      </MemberPageContainer>\n  )\n}\n\nexport default PersonalInfo\n"]},"metadata":{},"sourceType":"module"}
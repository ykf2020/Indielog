{"ast":null,"code":"import _regeneratorRuntime from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useMemo,useRef,useEffect}from'react';import{Container,Nav,NavLogo,BodyContainer,Library,Song,SongInfo,ControlPanel,FontAwesome,SongName,AuthorName,ImgDiv,Slider,Buttons,Track,AnimateTrack,InputRange,SongCurrentTime,SongFullTime,FontAwesomeControl,ToggleButton,ButtonGroup,LibrarySongDiv,LibrarySongDesc,LibrarySongName,LibrarySongAuthorName,LibraryImgDiv,LoopButton,VolumeDiv,VolumeButtonDiv,VolumeInputRange,VolumeTrack,VolumeAnimateTrack,InnerButoons,MainFontAwesomeControl}from'./MusicPlayerFullElements.js';import{faPause,faPlay,faTimes,faVolumeUp,faChevronRight,faChevronLeft,faUndo,faToggleOff,faToggleOn,faCompressAlt,faVolumeMute}from'@fortawesome/free-solid-svg-icons';import{useDispatch,useSelector}from\"react-redux\";import{setCurrentSong}from\"../../redux/reducers/songReducer\";import{setSound,setIsPlaying,setMode,setSongPlayingInfo,setLoop}from\"../../redux/reducers/playerControlReducer\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var MusicPlayerFull=function MusicPlayerFull(_ref){var audioRef=_ref.audioRef;var dispatch=useDispatch();var volumeBarRef=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),volumeBarIsShown=_useState2[0],setVolumeBarIsShown=_useState2[1];var mode=useSelector(function(store){return store.playerControl.mode;});var isPlaying=useSelector(function(store){return store.playerControl.isPlaying;});var songs=useSelector(function(store){return store.song.songs;});var currentSong=useSelector(function(store){return store.song.currentSong;});var songPlayingInfo=useSelector(function(store){return store.playerControl.songPlayingInfo;});var sound=useSelector(function(store){return store.playerControl.sound;});var loop=useSelector(function(store){return store.playerControl.loop;});var bgImg=useMemo(function(){return currentSong.cover;},[currentSong]);var getTime=function getTime(time){return Math.floor(time/60)+\":\"+(\"0\"+Math.floor(time%60)).slice(-2);};function playSongHandler(){dispatch(setIsPlaying(!isPlaying));}function dragHandler(e){audioRef.current.currentTime=e.target.value;dispatch(setSongPlayingInfo(_objectSpread(_objectSpread({},songPlayingInfo),{},{currentTime:e.target.value})));}function skipTrackHandler(_x){return _skipTrackHandler.apply(this,arguments);}function _skipTrackHandler(){_skipTrackHandler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(direction){var currentIndex;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:currentIndex=songs.findIndex(function(song){return song.id===currentSong.id;});if(!(direction==='skip-forward')){_context.next=4;break;}_context.next=4;return dispatch(setCurrentSong(songs[(currentIndex+1)%songs.length]));case 4:if(!(direction==='skip-back')){_context.next=13;break;}if(!(songPlayingInfo.currentTime>10)){_context.next=9;break;}audioRef.current.currentTime=0;dispatch(setSongPlayingInfo(_objectSpread(_objectSpread({},songPlayingInfo),{},{currentTime:0})));return _context.abrupt(\"return\");case 9:if(!((currentIndex-1)%songs.length===-1)){_context.next=12;break;}dispatch(setCurrentSong(songs[songs.length-1]));return _context.abrupt(\"return\");case 12:dispatch(setCurrentSong(songs[(currentIndex-1)%songs.length]));case 13:case\"end\":return _context.stop();}}},_callee);}));return _skipTrackHandler.apply(this,arguments);}function volumeHandler(e){if(e.target.value==0){dispatch(setSound(_objectSpread(_objectSpread({},sound),{},{mute:true,volume:e.target.value})));}else{dispatch(setSound(_objectSpread(_objectSpread({},sound),{},{mute:false,volume:e.target.value,prevVolume:e.target.value})));}audioRef.current.volume=e.target.value;}function songSelectHandler(_x2){return _songSelectHandler.apply(this,arguments);}function _songSelectHandler(){_songSelectHandler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(song){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(setCurrentSong(song));case 1:case\"end\":return _context2.stop();}}},_callee2);}));return _songSelectHandler.apply(this,arguments);}useEffect(function(){function handleClickOutside(event){if(volumeBarRef.current&&!volumeBarRef.current.contains(event.target)){setVolumeBarIsShown(false);}}document.addEventListener(\"mousedown\",handleClickOutside);return function(){document.removeEventListener(\"mousedown\",handleClickOutside);};},[volumeBarRef]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Container,{bgImg:bgImg,children:[/*#__PURE__*/_jsxs(Nav,{children:[/*#__PURE__*/_jsx(NavLogo,{to:\"/\",children:\"Indielog\"}),/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsx(FontAwesome,{onClick:function onClick(){return dispatch(setMode(1));},size:\"2x\",icon:faCompressAlt}),/*#__PURE__*/_jsx(FontAwesome,{onClick:function onClick(){return dispatch(setMode(0));},size:\"2x\",icon:faTimes})]}),/*#__PURE__*/_jsx(ToggleButton,{size:\"2x\",icon:mode===3?faToggleOn:faToggleOff,onClick:function onClick(){return dispatch(setMode(mode===3?2:3));}})]}),/*#__PURE__*/_jsxs(BodyContainer,{children:[/*#__PURE__*/_jsx(Library,{mode:mode,children:songs.map(function(song){return/*#__PURE__*/_jsxs(LibrarySongDiv,{onClick:function onClick(){return songSelectHandler(song);},active:song.id===currentSong.id,children:[/*#__PURE__*/_jsx(LibraryImgDiv,{children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:song.cover})}),/*#__PURE__*/_jsxs(LibrarySongDesc,{children:[/*#__PURE__*/_jsx(LibrarySongName,{children:song.name}),/*#__PURE__*/_jsx(LibrarySongAuthorName,{children:song.artist})]})]},song.id);})}),/*#__PURE__*/_jsxs(Song,{mode:mode,children:[/*#__PURE__*/_jsxs(SongInfo,{mode:mode,children:[/*#__PURE__*/_jsx(ImgDiv,{mode:mode,children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",src:currentSong.cover})}),/*#__PURE__*/_jsx(SongName,{mode:mode,children:currentSong.name}),/*#__PURE__*/_jsx(AuthorName,{children:currentSong.artist})]}),/*#__PURE__*/_jsxs(ControlPanel,{children:[/*#__PURE__*/_jsxs(Slider,{children:[/*#__PURE__*/_jsx(SongCurrentTime,{children:getTime(songPlayingInfo.currentTime)}),/*#__PURE__*/_jsxs(Track,{children:[/*#__PURE__*/_jsx(InputRange,{min:0,max:songPlayingInfo===null||songPlayingInfo===void 0?void 0:songPlayingInfo.duration,value:songPlayingInfo===null||songPlayingInfo===void 0?void 0:songPlayingInfo.currentTime,onChange:dragHandler,type:\"range\"}),/*#__PURE__*/_jsx(AnimateTrack,{animationPercentage:songPlayingInfo.animationPercentage})]}),/*#__PURE__*/_jsx(SongFullTime,{children:getTime(songPlayingInfo.duration||0)})]}),/*#__PURE__*/_jsxs(Buttons,{children:[/*#__PURE__*/_jsx(LoopButton,{onClick:function onClick(){return dispatch(setLoop(!loop));},active:loop,size:\"1x\",icon:faUndo}),/*#__PURE__*/_jsxs(InnerButoons,{children:[/*#__PURE__*/_jsx(FontAwesomeControl,{onClick:function onClick(){skipTrackHandler('skip-back');},size:\"1x\",icon:faChevronLeft}),/*#__PURE__*/_jsx(MainFontAwesomeControl,{onClick:playSongHandler,size:\"2x\",icon:isPlaying?faPause:faPlay}),/*#__PURE__*/_jsx(FontAwesomeControl,{onClick:function onClick(){skipTrackHandler('skip-forward');},size:\"1x\",icon:faChevronRight})]}),/*#__PURE__*/_jsxs(VolumeButtonDiv,{children:[/*#__PURE__*/_jsx(FontAwesomeControl,{size:\"1x\",icon:sound.mute?faVolumeMute:faVolumeUp,onClick:function onClick(){return setVolumeBarIsShown(!volumeBarIsShown);}}),volumeBarIsShown&&/*#__PURE__*/_jsx(VolumeDiv,{ref:volumeBarRef,children:/*#__PURE__*/_jsxs(VolumeTrack,{children:[/*#__PURE__*/_jsx(VolumeInputRange,{min:0,step:0.01,max:1,value:sound.volume,onChange:volumeHandler,type:\"range\"}),/*#__PURE__*/_jsx(VolumeAnimateTrack,{volume:sound.volume})]})})]})]})]})]})]})]})});};export default MusicPlayerFull;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/indielog/src/components/MusicPlayerFull/index.js"],"names":["useState","useMemo","useRef","useEffect","Container","Nav","NavLogo","BodyContainer","Library","Song","SongInfo","ControlPanel","FontAwesome","SongName","AuthorName","ImgDiv","Slider","Buttons","Track","AnimateTrack","InputRange","SongCurrentTime","SongFullTime","FontAwesomeControl","ToggleButton","ButtonGroup","LibrarySongDiv","LibrarySongDesc","LibrarySongName","LibrarySongAuthorName","LibraryImgDiv","LoopButton","VolumeDiv","VolumeButtonDiv","VolumeInputRange","VolumeTrack","VolumeAnimateTrack","InnerButoons","MainFontAwesomeControl","faPause","faPlay","faTimes","faVolumeUp","faChevronRight","faChevronLeft","faUndo","faToggleOff","faToggleOn","faCompressAlt","faVolumeMute","useDispatch","useSelector","setCurrentSong","setSound","setIsPlaying","setMode","setSongPlayingInfo","setLoop","MusicPlayerFull","audioRef","dispatch","volumeBarRef","volumeBarIsShown","setVolumeBarIsShown","mode","store","playerControl","isPlaying","songs","song","currentSong","songPlayingInfo","sound","loop","bgImg","cover","getTime","time","Math","floor","slice","playSongHandler","dragHandler","e","current","currentTime","target","value","skipTrackHandler","direction","currentIndex","findIndex","id","length","volumeHandler","mute","volume","prevVolume","songSelectHandler","handleClickOutside","event","contains","document","addEventListener","removeEventListener","map","name","artist","duration","animationPercentage"],"mappings":"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","sourcesContent":["import { useState, useMemo, useRef, useEffect } from 'react'\nimport {\n  Container,\n  Nav,\n  NavLogo,\n  BodyContainer,\n  Library,\n  Song,\n  SongInfo,\n  ControlPanel,\n  FontAwesome,\n  SongName,\n  AuthorName,\n  ImgDiv,\n  Slider,\n  Buttons,\n  Track,\n  AnimateTrack,\n  InputRange,\n  SongCurrentTime,\n  SongFullTime,\n  FontAwesomeControl,\n  ToggleButton,\n  ButtonGroup,\n  LibrarySongDiv,\n  LibrarySongDesc,\n  LibrarySongName,\n  LibrarySongAuthorName,\n  LibraryImgDiv,\n  LoopButton,\n  VolumeDiv,\n  VolumeButtonDiv,\n  VolumeInputRange,\n  VolumeTrack,\n  VolumeAnimateTrack,\n  InnerButoons,\n  MainFontAwesomeControl\n} from './MusicPlayerFullElements.js'\nimport {\n  faPause,\n  faPlay,\n  faTimes,\n  faVolumeUp,\n  faChevronRight,\n  faChevronLeft,\n  faUndo,\n  faToggleOff,\n  faToggleOn,\n  faCompressAlt,\n  faVolumeMute\n} from '@fortawesome/free-solid-svg-icons'\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setCurrentSong } from \"../../redux/reducers/songReducer\";\nimport { setSound, setIsPlaying, setMode, setSongPlayingInfo, setLoop } from \"../../redux/reducers/playerControlReducer\"\n\n\nconst MusicPlayerFull = ({ audioRef }) => {\n  const dispatch = useDispatch()\n  const volumeBarRef = useRef(null)\n  const [volumeBarIsShown, setVolumeBarIsShown] = useState(false)\n  const mode = useSelector((store) => store.playerControl.mode)\n  const isPlaying = useSelector((store) => store.playerControl.isPlaying)\n  const songs = useSelector((store) => store.song.songs)\n  const currentSong = useSelector((store) => store.song.currentSong)\n  const songPlayingInfo = useSelector((store) => store.playerControl.songPlayingInfo)\n  const sound = useSelector((store) => store.playerControl.sound)\n  const loop = useSelector((store) => store.playerControl.loop)\n\n  const bgImg = useMemo(() => {\n    return currentSong.cover\n  }, [currentSong])\n\n  const getTime = (time) => {\n    return(\n      Math.floor(time / 60) + \":\" + (\"0\" + Math.floor(time % 60)).slice(-2)\n    )\n  }\n\n  function playSongHandler(){\n    dispatch(setIsPlaying(!isPlaying))\n  }\n\n  function dragHandler(e){\n    audioRef.current.currentTime = e.target.value\n    dispatch(setSongPlayingInfo({...songPlayingInfo, currentTime: e.target.value}))\n  }\n\n  async function skipTrackHandler(direction){\n    let currentIndex = songs.findIndex((song) => song.id === currentSong.id)\n    if(direction === 'skip-forward') {\n      await dispatch(setCurrentSong(songs[(currentIndex + 1) % songs.length]))\n    }\n    if(direction === 'skip-back'){\n      if(songPlayingInfo.currentTime > 10) {\n        audioRef.current.currentTime = 0\n        dispatch(setSongPlayingInfo({...songPlayingInfo, currentTime: 0}))\n        return\n      }\n      if((currentIndex - 1) % songs.length === -1){\n        dispatch(setCurrentSong(songs[songs.length-1]))\n        return\n      }\n        dispatch(setCurrentSong(songs[(currentIndex - 1) % songs.length]))\n    }\n  }\n\n  function volumeHandler(e){\n    if(e.target.value == 0) {\n      dispatch(setSound({ ...sound, mute:true, volume: e.target.value}))\n    } else {\n      dispatch(setSound({ ...sound, mute:false, volume: e.target.value, prevVolume: e.target.value}))\n    }\n    audioRef.current.volume = e.target.value\n  }\n\n  async function songSelectHandler(song){\n      dispatch(setCurrentSong(song))\n  }\n\n  useEffect(() => {\n    function handleClickOutside(event) {\n      if (volumeBarRef.current && !volumeBarRef.current.contains(event.target)) {\n        setVolumeBarIsShown(false);\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, [volumeBarRef]);\n\n  return (\n    <>\n      <Container bgImg={bgImg}>\n        <Nav>\n          <NavLogo to='/'>Indielog</NavLogo>\n          <ButtonGroup>\n            <FontAwesome onClick={() => dispatch(setMode(1))} size='2x' icon={faCompressAlt}/>\n            <FontAwesome onClick={() => dispatch(setMode(0))} size='2x' icon={faTimes} />\n          </ButtonGroup>\n          <ToggleButton size='2x' icon={(mode===3) ? faToggleOn : faToggleOff } onClick={() => dispatch(setMode((mode === 3) ? 2 : 3))}/>\n        </Nav>\n        <BodyContainer>\n          <Library mode={mode}>\n            {songs.map(song => {\n              return (\n                <LibrarySongDiv key={song.id} onClick={() => songSelectHandler(song)} active={song.id === currentSong.id}>\n                  <LibraryImgDiv>\n                    <img alt='' src={song.cover}/>\n                  </LibraryImgDiv>\n                  <LibrarySongDesc>\n                    <LibrarySongName>{song.name}</LibrarySongName>\n                    <LibrarySongAuthorName>{song.artist}</LibrarySongAuthorName>\n                  </LibrarySongDesc>\n                </LibrarySongDiv>\n              )\n            })}\n          </Library>\n          <Song mode={mode}>\n            <SongInfo mode={mode}>\n              <ImgDiv mode={mode}><img alt='' src={currentSong.cover}/></ImgDiv>\n              <SongName mode={mode}>{currentSong.name}</SongName>\n              <AuthorName>{currentSong.artist}</AuthorName>\n            </SongInfo>\n            <ControlPanel>\n              <Slider>\n                <SongCurrentTime>{getTime(songPlayingInfo.currentTime)}</SongCurrentTime>\n                <Track>\n                  <InputRange\n                    min={0}\n                    max={songPlayingInfo?.duration}\n                    value={songPlayingInfo?.currentTime}\n                    onChange={dragHandler}\n                    type=\"range\"\n                  />\n                  <AnimateTrack animationPercentage={songPlayingInfo.animationPercentage} />\n                </Track>\n                <SongFullTime>{getTime(songPlayingInfo.duration || 0)}</SongFullTime>\n              </Slider>\n              <Buttons>\n                <LoopButton onClick={() => dispatch(setLoop(!loop)) } active={loop} size='1x' icon={faUndo} />\n                <InnerButoons>\n                  <FontAwesomeControl onClick={() => {skipTrackHandler('skip-back')}} size='1x' icon={faChevronLeft} />\n                  <MainFontAwesomeControl onClick={playSongHandler} size='2x' icon={isPlaying ? faPause : faPlay} />\n                  <FontAwesomeControl onClick={() => {skipTrackHandler('skip-forward')}} size='1x' icon={faChevronRight} />\n                </InnerButoons>\n                <VolumeButtonDiv>\n                  <FontAwesomeControl size='1x' icon={sound.mute ? faVolumeMute : faVolumeUp} onClick={() => setVolumeBarIsShown(!volumeBarIsShown)}/>\n                  {volumeBarIsShown && (\n                    <VolumeDiv ref={volumeBarRef}>\n                      <VolumeTrack>\n                        <VolumeInputRange\n                          min={0}\n                          step={0.01}\n                          max={1}\n                          value={sound.volume}\n                          onChange={volumeHandler}\n                          type=\"range\"\n                        />\n                        <VolumeAnimateTrack volume={sound.volume} />\n                      </VolumeTrack>\n                    </VolumeDiv>\n                  )}\n                </VolumeButtonDiv>\n              </Buttons>\n            </ControlPanel>\n          </Song>\n        </BodyContainer>\n      </Container>\n    </>\n  )\n}\n\nexport default MusicPlayerFull\n"]},"metadata":{},"sourceType":"module"}
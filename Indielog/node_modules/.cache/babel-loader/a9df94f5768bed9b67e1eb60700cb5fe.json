{"ast":null,"code":"var _jsxFileName = \"/Users/fanyukun/Documents/react/indielog/src/components/MusicPlayer/index.js\",\n    _s = $RefreshSig$();\n\nimport { useRef } from 'react';\nimport MusicPlayerSmall from '../MusicPlayerSmall';\nimport MusicPlayerFull from '../MusicPlayerFull';\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setCurrentSong } from \"../../redux/reducers/songReducer\";\nimport { setSongPlayingInfo } from \"../../redux/reducers/playerControlReducer\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst MusicPlayer = () => {\n  _s();\n\n  const audioRef = useRef(null);\n  const dispatch = useDispatch();\n  const isPlaying = useSelector(store => store.playerControl.isPlaying);\n  const sound = useSelector(store => store.playerControl.sound);\n  const songPlayingInfo = useSelector(store => store.playerControl.songPlayingInfo);\n  const songs = useSelector(store => store.song.songs);\n  const currentSong = useSelector(store => store.song.currentSong);\n  const mode = useSelector(store => store.playerControl.mode);\n\n  const timeUpdateHandler = e => {\n    const current = e.target.currentTime;\n    const duration = e.target.duration;\n    const roundedCurrent = Math.round(current);\n    const roundedDuration = Math.round(duration);\n    const animationPercentage = Math.round(roundedCurrent / roundedDuration * 100);\n    dispatch(setSongPlayingInfo({ ...songPlayingInfo,\n      currentTime: current,\n      duration,\n      animationPercentage\n    }));\n    console.log(sound);\n  };\n\n  const songEndHandler = () => {\n    let currentIndex = songs.findIndex(song => song.id === currentSong.id);\n    dispatch(setCurrentSong(songs[(currentIndex + 1) % songs.length]));\n\n    if (isPlaying) {\n      audioRef.current.play();\n    }\n  };\n\n  useEffect(() => {\n    if (mode === 0) audioRef.current.pause();\n  }, [mode]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [(mode === 2 || mode === 3) && /*#__PURE__*/_jsxDEV(MusicPlayerSmall, {\n      audioRef: audioRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 38\n    }, this), mode === 1 && /*#__PURE__*/_jsxDEV(MusicPlayerFull, {\n      audioRef: audioRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 22\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      volume: sound.volume,\n      muted: sound.mute,\n      onTimeUpdate: timeUpdateHandler,\n      onLoadedMetadata: timeUpdateHandler,\n      ref: audioRef,\n      src: currentSong.audio,\n      onEnded: songEndHandler\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(MusicPlayer, \"8oSk5HtafUuiZeyPtQZ0iqwy8G8=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = MusicPlayer;\nexport default MusicPlayer;\n\nvar _c;\n\n$RefreshReg$(_c, \"MusicPlayer\");","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/indielog/src/components/MusicPlayer/index.js"],"names":["useRef","MusicPlayerSmall","MusicPlayerFull","useDispatch","useSelector","setCurrentSong","setSongPlayingInfo","MusicPlayer","audioRef","dispatch","isPlaying","store","playerControl","sound","songPlayingInfo","songs","song","currentSong","mode","timeUpdateHandler","e","current","target","currentTime","duration","roundedCurrent","Math","round","roundedDuration","animationPercentage","console","log","songEndHandler","currentIndex","findIndex","id","length","play","useEffect","pause","volume","mute","audio"],"mappings":"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","sourcesContent":["import { useRef } from 'react'\nimport MusicPlayerSmall from '../MusicPlayerSmall'\nimport MusicPlayerFull from '../MusicPlayerFull'\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { setCurrentSong } from \"../../redux/reducers/songReducer\";\nimport { setSongPlayingInfo } from \"../../redux/reducers/playerControlReducer\"\n\nconst MusicPlayer = () => {\n  const audioRef = useRef(null)\n  const dispatch = useDispatch()\n  const isPlaying = useSelector((store) => store.playerControl.isPlaying)\n  const sound = useSelector((store) => store.playerControl.sound)\n  const songPlayingInfo = useSelector((store) => store.playerControl.songPlayingInfo)\n  const songs = useSelector((store) => store.song.songs)\n  const currentSong = useSelector((store) => store.song.currentSong)\n  const mode = useSelector((store) => store.playerControl.mode)\n\n  const timeUpdateHandler = (e) => {\n    const current = e.target.currentTime\n    const duration = e.target.duration\n    const roundedCurrent = Math.round(current)\n    const roundedDuration = Math.round(duration)\n    const animationPercentage = Math.round((roundedCurrent / roundedDuration) * 100 )\n    dispatch(setSongPlayingInfo({\n      ...songPlayingInfo,\n      currentTime: current,\n      duration,\n      animationPercentage,\n    }))\n    console.log(sound)\n  }\n\n  const songEndHandler = () => {\n    let currentIndex = songs.findIndex((song) => song.id === currentSong.id)\n    dispatch(setCurrentSong(songs[(currentIndex + 1) % songs.length]))\n    if (isPlaying) {\n      audioRef.current.play()\n    }\n  }\n  \n  useEffect(() => {\n    if(mode === 0) audioRef.current.pause()\n  },[mode])\n\n  return (\n    <>\n      {(mode === 2 || mode === 3) && <MusicPlayerSmall audioRef={audioRef} />}\n      {mode === 1 && <MusicPlayerFull audioRef={audioRef} />}\n      <audio\n        volume={sound.volume}\n        muted={sound.mute}\n        onTimeUpdate={timeUpdateHandler}\n        onLoadedMetadata={timeUpdateHandler}\n        ref={audioRef}\n        src={currentSong.audio}\n        onEnded={songEndHandler}\n      ></audio>\n\n    </>\n  )\n}\n\nexport default MusicPlayer\n"]},"metadata":{},"sourceType":"module"}
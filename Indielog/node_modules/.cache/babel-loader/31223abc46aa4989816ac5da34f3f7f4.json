{"ast":null,"code":"import _objectSpread from\"/Users/fanyukun/Documents/react/indielog/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import firebase from'firebase/compat/app';import'firebase/compat/auth';import'firebase/compat/firestore';import'firebase/compat/storage';import config from'./config.js';firebase.initializeApp(config);var db=firebase.firestore();var auth=firebase.auth();var storage=firebase.storage();var usersDb=db.collection('users');var postsDb=db.collection('posts');var songsDb=db.collection('songs');var topicsDb=db.collection('topics');// auth\nexport var signUp=function signUp(email,password,handleSuccess,handleErrMessage){auth.createUserWithEmailAndPassword(email,password).then(function(signUpResult){usersDb.doc(signUpResult.user.uid).set({email:email,photoURL:'',displayName:'',introduction:'',createdAt:firebase.firestore.Timestamp.now()}).then(function(){handleSuccess();}).catch(function(err){switch(err.code){case\"auth/email-already-in-use\":handleErrMessage('信箱已存在');break;case\"auth/invalid-email\":handleErrMessage('信箱格式錯誤');break;case\"auth/weak-password\":handleErrMessage('密碼強度不足');break;default:handleErrMessage(err.code);}});});};export var signIn=function signIn(email,password,handleSuccess,handleErrMessage){auth.signInWithEmailAndPassword(email,password).then(function(){handleSuccess();}).catch(function(err){switch(err.code){case\"auth/invalid-email\":handleErrMessage('信箱格式錯誤');break;case\"auth/user-not-found\":handleErrMessage('信箱不存在');break;case\"auth/wrong-password\":handleErrMessage('密碼錯誤');break;default:handleErrMessage(err.code);}});};export var signOut=function signOut(){auth.signOut();};export var checkUserStatus=function checkUserStatus(handleUser){auth.onAuthStateChanged(function(user){if(user){handleUser({uid:user.uid,displayName:user.displayName,email:user.email,photoURL:user.photoURL});}else{handleUser(null);}});};export var forgetPassword=function forgetPassword(email){return auth.sendPasswordResetEmail(email);};// firestore\n// topics\nexport var getTopics=function getTopics(handleTopics){topicsDb.get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleTopics(data);});};export var getTopicsAndSetDefaultTopic=function getTopicsAndSetDefaultTopic(handleTopics,handleCurrentTopic){topicsDb.get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleTopics(data);handleCurrentTopic(data[0].name);});};// posts\nexport var getPost=function getPost(postId,handlePost){postsDb.doc(postId).get().then(function(docSnapShot){handlePost(docSnapShot.data());});};export var getPostWithAuthorInfo=function getPostWithAuthorInfo(postId,handlePost,handleAuthorInfo){postsDb.doc(postId).onSnapshot(function(docSnapShot){var data=docSnapShot.data();handlePost(data);usersDb.doc(data.author.uid).get().then(function(userSnapShot){handleAuthorInfo(userSnapShot.data());});});};export var getSeedPosts=function getSeedPosts(topic,limit,handlePosts){if(!topic){postsDb.orderBy('createdAt','desc').limit(limit).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});}else{postsDb.orderBy('createdAt','desc').where('topic','==',topic).limit(limit).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});}};export var getChangePagePosts=function getChangePagePosts(topic,limit,handlePosts,lastRefPlace){if(!topic){postsDb.orderBy('createdAt','desc').get().then(function(collectionSnapShot){var ref=collectionSnapShot.docs[lastRefPlace];postsDb.orderBy('createdAt','desc').startAt(ref).limit(limit).get().then(function(snapshot){var data=snapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});});}else{postsDb.orderBy('createdAt','desc').where('topic','==',topic).get().then(function(collectionSnapShot){var ref=collectionSnapShot.docs[lastRefPlace];postsDb.orderBy('createdAt','desc').limit(limit).startAt(ref).get().then(function(snapshot){var data=snapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});});}};export var getPostsAmount=function getPostsAmount(topic,limit,handlePosts){if(!topic){postsDb.get().then(function(collectionSnapShot){var amount=collectionSnapShot.size;var pages=amount%limit===0?amount/limit:Math.ceil(amount/limit);handlePosts(pages);});}else{postsDb.where('topic','==',topic).get().then(function(collectionSnapShot){var amount=collectionSnapShot.size;var pages=amount%limit===0?amount/limit:Math.ceil(amount/limit);handlePosts(pages);});}};export var addNewPost=function addNewPost(image,postInfo,handleSuccess){var documentRef=postsDb.doc();var imageRef=storage.ref('post-images/'+documentRef.id);var metadata={contentType:image.type};imageRef.put(image,metadata).then(function(){imageRef.getDownloadURL().then(function(imageUrl){documentRef.set({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,createdAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId},imageUrl:imageUrl});handleSuccess(documentRef.id);});});};export var updatePost=function updatePost(postId,postInfo,handleSuccess){var documentRef=postsDb.doc(postId);documentRef.update({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,updatedAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId}}).then(function(){handleSuccess(postId);});};export var updatePostWithNewPic=function updatePostWithNewPic(postId,image,postInfo,handleSuccess){var documentRef=postsDb.doc(postId);var imageRef=storage.ref('post-images/'+documentRef.id);var metadata={contentType:image.type};imageRef.put(image,metadata).then(function(){imageRef.getDownloadURL().then(function(imageUrl){documentRef.update({title:postInfo.title,content:postInfo.content,topic:postInfo.topic,updatedAt:firebase.firestore.Timestamp.now(),author:{uid:postInfo.userId},imageUrl:imageUrl});handleSuccess(documentRef.id);});});};export var getMyPostsOnSnapshot=function getMyPostsOnSnapshot(userId,handlePosts){postsDb.where('author.uid','==',userId).onSnapshot(function(collectionSnapshot){var data=collectionSnapshot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});};export var togglePostLiked=function togglePostLiked(isLiked,postId,userId){if(isLiked){var _firebase$firestore$F;postsDb.doc(postId).update({likedBy:(_firebase$firestore$F=firebase.firestore.FieldValue)===null||_firebase$firestore$F===void 0?void 0:_firebase$firestore$F.arrayRemove(userId)});}else{var _firebase$firestore$F2;postsDb.doc(postId).update({likedBy:(_firebase$firestore$F2=firebase.firestore.FieldValue)===null||_firebase$firestore$F2===void 0?void 0:_firebase$firestore$F2.arrayUnion(userId)});}};export var getLikedPosts=function getLikedPosts(userId,handlePosts){postsDb.where('likedBy','array-contains',userId).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handlePosts(data);});};export var deletePost=function deletePost(postId){postsDb.doc(postId).delete().then(function(){alert('已刪除文章');});};// authors\nexport var getAuthorInfo=function getAuthorInfo(authorId,handleAuthorInfo){usersDb.doc(authorId).get().then(function(userSnapShot){handleAuthorInfo(userSnapShot.data());});};// comments\nexport var getCommentsOnSnapshot=function getCommentsOnSnapshot(area,id,handleComments){db.collection(area).doc(id).collection('comments').orderBy('createdAt','asc').onSnapshot(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){return{authorUid:doc.data().authorUid,content:doc.data().content,createdAt:doc.data().createdAt};});handleComments(data);});};export var addNewComment=function addNewComment(area,id,commentContent,authorId){return db.collection(area).doc(id).collection('comments').doc().set({content:commentContent,createdAt:firebase.firestore.Timestamp.now(),authorUid:authorId});};// songs\nexport var getLikedSongs=function getLikedSongs(userId,handleSongs){songsDb.where('likedBy','array-contains',userId).get().then(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleSongs(data);});};export var getSongsOnSnapShot=function getSongsOnSnapShot(handleSongs){songsDb.onSnapshot(function(collectionSnapShot){var data=collectionSnapShot.docs.map(function(doc){var id=doc.id;return _objectSpread(_objectSpread({},doc.data()),{},{id:id});});handleSongs(data);});};export var toggleSongLiked=function toggleSongLiked(isLiked,songId,userId){if(isLiked){var _firebase$firestore$F3;songsDb.doc(songId).update({likedBy:(_firebase$firestore$F3=firebase.firestore.FieldValue)===null||_firebase$firestore$F3===void 0?void 0:_firebase$firestore$F3.arrayRemove(userId)});}else{var _firebase$firestore$F4;songsDb.doc(songId).update({likedBy:(_firebase$firestore$F4=firebase.firestore.FieldValue)===null||_firebase$firestore$F4===void 0?void 0:_firebase$firestore$F4.arrayUnion(userId)});}};export var getSongOnSnapShot=function getSongOnSnapShot(songId,handleSong){songsDb.doc(songId).onSnapshot(function(docSnapshot){return handleSong(docSnapshot.data());});};export default firebase;","map":{"version":3,"sources":["/Users/fanyukun/Documents/react/indielog/src/utils/firebase.js"],"names":["firebase","config","initializeApp","db","firestore","auth","storage","usersDb","collection","postsDb","songsDb","topicsDb","signUp","email","password","handleSuccess","handleErrMessage","createUserWithEmailAndPassword","then","signUpResult","doc","user","uid","set","photoURL","displayName","introduction","createdAt","Timestamp","now","catch","err","code","signIn","signInWithEmailAndPassword","signOut","checkUserStatus","handleUser","onAuthStateChanged","forgetPassword","sendPasswordResetEmail","getTopics","handleTopics","get","collectionSnapShot","data","docs","map","id","getTopicsAndSetDefaultTopic","handleCurrentTopic","name","getPost","postId","handlePost","docSnapShot","getPostWithAuthorInfo","handleAuthorInfo","onSnapshot","author","userSnapShot","getSeedPosts","topic","limit","handlePosts","orderBy","where","getChangePagePosts","lastRefPlace","ref","startAt","snapshot","getPostsAmount","amount","size","pages","Math","ceil","addNewPost","image","postInfo","documentRef","imageRef","metadata","contentType","type","put","getDownloadURL","imageUrl","title","content","userId","updatePost","update","updatedAt","updatePostWithNewPic","getMyPostsOnSnapshot","collectionSnapshot","togglePostLiked","isLiked","likedBy","FieldValue","arrayRemove","arrayUnion","getLikedPosts","deletePost","delete","alert","getAuthorInfo","authorId","getCommentsOnSnapshot","area","handleComments","authorUid","addNewComment","commentContent","getLikedSongs","handleSongs","getSongsOnSnapShot","toggleSongLiked","songId","getSongOnSnapShot","handleSong","docSnapshot"],"mappings":"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","sourcesContent":["import firebase from 'firebase/compat/app'\nimport 'firebase/compat/auth'\nimport 'firebase/compat/firestore'\nimport 'firebase/compat/storage'\nimport config from './config.js'\n\nfirebase.initializeApp(config);\n\nconst db = firebase.firestore();\nconst auth = firebase.auth();\nconst storage = firebase.storage()\nconst usersDb = db.collection('users')\nconst postsDb = db.collection('posts')\nconst songsDb = db.collection('songs')\nconst topicsDb = db.collection('topics')\n\n\n// auth\nexport const signUp = (email, password, handleSuccess, handleErrMessage) => {\n  auth.createUserWithEmailAndPassword(email, password).then((signUpResult) => {\n    usersDb.doc(signUpResult.user.uid).set({\n      email,\n      photoURL: '',\n      displayName: '',\n      introduction: '',\n      createdAt: firebase.firestore.Timestamp.now()\n    }).then(() => {\n      handleSuccess()\n    }).catch((err) => {\n      switch(err.code) {\n        case \"auth/email-already-in-use\":\n          handleErrMessage('信箱已存在')\n          break\n        case \"auth/invalid-email\":\n          handleErrMessage('信箱格式錯誤')\n          break\n        case \"auth/weak-password\":\n          handleErrMessage('密碼強度不足')\n          break\n        default:\n          handleErrMessage(err.code)\n      }\n    })\n  })\n}\n\nexport const signIn = (email, password, handleSuccess, handleErrMessage) => {\n  auth.signInWithEmailAndPassword(email, password).then(() => {\n    handleSuccess()\n  }).catch((err) => {\n    switch(err.code) {\n      case \"auth/invalid-email\":\n        handleErrMessage('信箱格式錯誤')\n        break\n      case \"auth/user-not-found\":\n        handleErrMessage('信箱不存在')\n        break\n      case \"auth/wrong-password\":\n        handleErrMessage('密碼錯誤')\n        break\n      default:\n        handleErrMessage(err.code)\n    }\n  })\n}\n\nexport const signOut = () => {\n  auth.signOut()\n}\n\nexport const checkUserStatus = (handleUser) => {\n  auth.onAuthStateChanged((user) => {\n    if(user) {\n      handleUser({\n        uid: user.uid,\n        displayName: user.displayName,\n        email: user.email,\n        photoURL: user.photoURL\n      })\n    } else {\n      handleUser(null)\n    }\n  })\n}\n\nexport const forgetPassword = (email) => {\n  return auth.sendPasswordResetEmail(email)\n}\n\n\n// firestore\n// topics\nexport const getTopics = (handleTopics) => {\n  topicsDb.get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleTopics(data)\n  })\n}\n\nexport const getTopicsAndSetDefaultTopic = (handleTopics, handleCurrentTopic) => {\n  topicsDb.get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleTopics(data)\n    handleCurrentTopic(data[0].name)\n  })\n}\n\n// posts\nexport const getPost = (postId, handlePost) => {\n  postsDb.doc(postId).get().then((docSnapShot) => {\n    handlePost(docSnapShot.data())\n  })\n}\n\nexport const getPostWithAuthorInfo = (postId, handlePost, handleAuthorInfo) => {\n  postsDb.doc(postId).onSnapshot((docSnapShot) => {\n    const data = docSnapShot.data()\n    handlePost(data)\n    usersDb.doc(data.author.uid).get().then((userSnapShot) => {\n      handleAuthorInfo(userSnapShot.data())\n    })\n  })\n}\n\nexport const getSeedPosts = (topic, limit, handlePosts) => {\n  if(!topic) {\n    postsDb.orderBy('createdAt','desc').limit(limit).get().then((collectionSnapShot) => {\n      const data = collectionSnapShot.docs.map((doc) => {\n        const id = doc.id\n        return {...doc.data(),id}\n      })\n      handlePosts(data)\n    })\n  } else {\n    postsDb.orderBy('createdAt','desc').where('topic','==',topic).limit(limit).get().then((collectionSnapShot) => {\n      const data = collectionSnapShot.docs.map((doc) => {\n        const id = doc.id\n        return {...doc.data(),id}\n      })\n      handlePosts(data)\n    })\n  }\n}\n\nexport const getChangePagePosts = (topic, limit, handlePosts, lastRefPlace) => {\n  if(!topic) {\n    postsDb.orderBy('createdAt','desc').get().then((collectionSnapShot) => {\n      const ref = collectionSnapShot.docs[lastRefPlace]\n      postsDb.orderBy('createdAt','desc').startAt(ref).limit(limit).get().then(snapshot => {\n        const data = snapshot.docs.map((doc) => {\n          const id = doc.id\n          return {...doc.data(),id}\n        })\n        handlePosts(data)\n      })\n    })\n  } else {\n    postsDb.orderBy('createdAt','desc').where('topic','==',topic).get().then((collectionSnapShot) => {\n      const ref = collectionSnapShot.docs[lastRefPlace]\n      postsDb.orderBy('createdAt','desc').limit(limit).startAt(ref).get().then(snapshot => {\n        const data = snapshot.docs.map((doc) => {\n          const id = doc.id\n          return {...doc.data(),id}\n        })\n        handlePosts(data)\n      })\n    })\n  }\n}\n\nexport const getPostsAmount = (topic, limit, handlePosts) => {\n  if(!topic) {\n    postsDb.get().then(collectionSnapShot => {\n      const amount = collectionSnapShot.size\n      const pages = amount % limit === 0 ? amount / limit : Math.ceil(amount / limit);\n      handlePosts(pages)\n    })\n  } else {\n    postsDb.where('topic','==',topic).get().then(collectionSnapShot => {\n      const amount = collectionSnapShot.size\n      const pages = amount % limit === 0 ? amount / limit : Math.ceil(amount / limit);\n      handlePosts(pages)\n    })\n  }\n\n}\n\nexport const addNewPost = (image, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc()\n  const imageRef = storage.ref('post-images/' + documentRef.id)\n  const metadata = {\n    contentType: image.type\n  }\n\n  imageRef.put(image, metadata).then(() => {\n    imageRef.getDownloadURL().then((imageUrl) => {\n      documentRef.set({\n        title: postInfo.title,\n        content: postInfo.content,\n        topic: postInfo.topic,\n        createdAt: firebase.firestore.Timestamp.now(),\n        author: {\n          uid: postInfo.userId,\n        },\n        imageUrl\n      })\n      handleSuccess(documentRef.id)\n    })\n  })\n}\n\nexport const updatePost = (postId, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc(postId)\n  documentRef.update({\n    title: postInfo.title,\n    content: postInfo.content,\n    topic: postInfo.topic,\n    updatedAt: firebase.firestore.Timestamp.now(),\n    author: {\n      uid: postInfo.userId,\n    }\n    }).then(() => {\n      handleSuccess(postId)\n    })\n}\n\nexport const updatePostWithNewPic = (postId, image, postInfo, handleSuccess) => {\n  const documentRef = postsDb.doc(postId)\n  const imageRef = storage.ref('post-images/' + documentRef.id)\n  const metadata = {\n    contentType: image.type\n  }\n\n  imageRef.put(image, metadata).then(() => {\n    imageRef.getDownloadURL().then((imageUrl) => {\n      documentRef.update({\n        title: postInfo.title,\n        content: postInfo.content,\n        topic: postInfo.topic,\n        updatedAt: firebase.firestore.Timestamp.now(),\n        author: {\n          uid: postInfo.userId,\n        },\n        imageUrl\n      })\n      handleSuccess(documentRef.id)\n    })\n  })\n}\n\nexport const getMyPostsOnSnapshot = (userId, handlePosts) => {\n  postsDb.where('author.uid','==', userId).onSnapshot((collectionSnapshot) => {\n    const data = collectionSnapshot.docs.map((doc) => {\n      const id = doc.id\n      return { ...doc.data(), id }\n    })\n    handlePosts(data)\n  })\n}\n\nexport const togglePostLiked = (isLiked, postId, userId) => {\n  if(isLiked) {\n    postsDb.doc(postId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayRemove(userId)\n    })\n  } else {\n    postsDb.doc(postId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayUnion(userId)\n    })\n  }\n}\n\nexport const getLikedPosts = (userId, handlePosts) => {\n  postsDb.where('likedBy', 'array-contains', userId).get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handlePosts(data)\n  })\n}\n\nexport const deletePost = (postId) => {\n  postsDb.doc(postId).delete().then(() => {\n    alert('已刪除文章')\n  })\n}\n\n// authors\nexport const getAuthorInfo = (authorId, handleAuthorInfo) => {\n  usersDb.doc(authorId).get().then((userSnapShot) => {\n    handleAuthorInfo(userSnapShot.data())\n  })\n}\n\n// comments\nexport const getCommentsOnSnapshot = (area, id, handleComments) => {\n  db.collection(area).doc(id).collection('comments').orderBy('createdAt','asc').onSnapshot((collectionSnapShot) => {\n     const data = collectionSnapShot.docs.map((doc) => {\n       return {\n         authorUid: doc.data().authorUid,\n         content: doc.data().content,\n         createdAt: doc.data().createdAt\n       }\n     })\n     handleComments(data)\n  })\n}\n\nexport const addNewComment = (area, id, commentContent, authorId) => {\n  return db.collection(area).doc(id).collection('comments').doc().set({\n    content: commentContent,\n    createdAt: firebase.firestore.Timestamp.now(),\n    authorUid: authorId,\n  })\n}\n\n// songs\nexport const getLikedSongs = (userId, handleSongs) => {\n  songsDb.where('likedBy', 'array-contains', userId).get().then((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleSongs(data)\n  })\n}\n\nexport const getSongsOnSnapShot = (handleSongs) => {\n  songsDb.onSnapshot((collectionSnapShot) => {\n    const data = collectionSnapShot.docs.map((doc) => {\n      const id = doc.id\n      return {...doc.data(),id}\n    })\n    handleSongs(data)\n  })\n}\n\nexport const toggleSongLiked = (isLiked, songId, userId) => {\n  if(isLiked) {\n    songsDb.doc(songId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayRemove(userId)\n    })\n  } else {\n    songsDb.doc(songId).update({\n      likedBy: firebase.firestore.FieldValue?.arrayUnion(userId)\n    })\n  }\n}\n\nexport const getSongOnSnapShot = (songId, handleSong) => {\n  songsDb.doc(songId).onSnapshot((docSnapshot) => handleSong(docSnapshot.data()))\n}\n\nexport default firebase\n"]},"metadata":{},"sourceType":"module"}